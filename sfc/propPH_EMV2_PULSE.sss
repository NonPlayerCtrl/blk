****************************************************************************************************
SEQUENCE STEP SCHEDULE
generated on 13/03/2019 3:52:07 PM by David Paspa
****************************************************************************************************





--------------------------------------------------
SEQUENCE
--------------------------------------------------

Name:- PULSE
Title:- PH_EMV2_PULSE
Description:- Open and close spray ball valves for specified duration.
Class:- EMV2
Level:- PH
STEP_LIST_FORMAT:- JU    S0@@STEP_NUM@@; // STEP-0@@STEP_NUM@@:
ACT_LIST_FORMAT:- JU    @@ACT_CODE@@@@STEP_NUM@@; //ACTION-@@ACT_NUM@@
HeaderName:- V2_PUL
Version:- 2.0
RevisionHistory:- // SFC Revision History:
// Rev By               Date        CC         Note
// 2.0 David Paspa      27-Nov-2018            Reboot for S7-1500
// 0.1 David Paspa      13-Jul-2009            SFC structural design
HMI_FORMAT:- @@STEP_NUM_INT@@,@@STEP_TITLE@@

--------------------------------------------------
PARAMETER::1
--------------------------------------------------
Name:- log_msg_pulse_begin
Type:- BOOL
Description:- PH_EMV2_PULSE begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::2
--------------------------------------------------
Name:- log_msg_pulse_end
Type:- BOOL
Description:- PH_EMV2_PULSE end time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::3
--------------------------------------------------
Name:- pos_sprayball2_state
Type:- INT
Description:- Spray Ball Valve 02 state
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::4
--------------------------------------------------
Name:- pos_sprayball1_state
Type:- INT
Description:- Spray Ball Valve 01 state
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::5
--------------------------------------------------
Name:- pos_sprayball1_cmd
Type:- INT
Description:- Spray Ball Valve 01 command
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::6
--------------------------------------------------
Name:- pos_sprayball2_cmd
Type:- INT
Description:- Spray Ball Valve 02 command
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::7
--------------------------------------------------
Name:- opened_time
Type:- TIME
Description:- Required open time for each spraybal inlet valve
ParameterInOut:- IN


--------------------------------------------------
STEP::01
--------------------------------------------------
StepNo:- 01
Title:- PH_EMV2_PULSE : Begin pulsing sprayball valves
Description:- Log PULSE begin time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log PULSE begin time.
Action:- //Log PULSE begin time.
SET;
S #_log_msg_pulse_begin;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::01
--------------------------------------------------
TRNNo:- 01
Title:- Unconditional Jump
EmptyTransition:- False
Description:- Jump
Condition:- A "uncondJump";


--------------------------------------------------
STEP::02
--------------------------------------------------
StepNo:- 02
Title:- PH_EMV2_PULSE : Open sprayball inlet valve 1 and close valve 2
Description:- Open sprayball inlet valve 1 and close valve 2.
Start timer.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Reset the timer
Action:- SET;
R #sqSeqTimerStart;
Verification:- AN #SQ_TIMER.Q;

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Open valve 1.
Action:- //Open valve 1
L "dbCONST".BLK.POSx.CMD.OPEN;
T  #_pos_sprayball1_cmd;

//Load setpoint for valve transition.
L T#3s;
T #SQ_TIMER.PT;

//Start timer.
SET;
S #sqSeqTimerStart;
Verification:- //Valve 01 opened.
A(;
L "dbCONST".BLK.POSx.STATE.OPENED;
L  #_pos_sprayball1_state;
==I;
);


--------------------------------------------------
ACTION::03
--------------------------------------------------
Description:- Wait for transition timer
Action:- NOP 0;
Verification:- A #SQ_TIMER.Q;

--------------------------------------------------
ACTION::04
--------------------------------------------------
Description:- Reset the timer
Action:- SET;
R #sqSeqTimerStart;
Verification:- AN #SQ_TIMER.Q;

--------------------------------------------------
ACTION::05
--------------------------------------------------
Description:- Close valve 2
Action:- //Close valve 02
L "dbCONST".BLK.POSx.CMD.CLOSE;
T  #_pos_sprayball2_cmd;
Verification:- //Valve 02 closed.
A(;
L "dbCONST".BLK.POSx.STATE.CLOSED; 
L #_pos_sprayball2_state;
==I;
);

--------------------------------------------------
ACTION::06
--------------------------------------------------
Description:- Start the valve opened timer
Action:- 
//Load setpoint for valve open duration.
L #_opened_time;
T #SQ_TIMER.PT;

//Start timer.
SET;
S #sqSeqTimerStart;


--------------------------------------------------
TRANSITION::02
--------------------------------------------------
TRNNo:- 02
Title:- Wait until timer expired
EmptyTransition:- False
Description:- Wait until delay time expired
Condition:- //Continue the sequence after the time delay expired.
A #SQ_TIMER.Q;


--------------------------------------------------
STEP::03
--------------------------------------------------
StepNo:- 3.0000
Title:- PH_EMV2_PULSE : Open sprayball inlet valve 2 and close valve1
Description:- Open sprayball inlet valve 2 and close valve 1.
Start timer.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Reset the timer
Action:- SET;
R #sqSeqTimerStart;
Verification:- AN #SQ_TIMER.Q;

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Open valve 2.
Action:- //Open valve 2
L "dbCONST".BLK.POSx.CMD.OPEN;
T  #_pos_sprayball2_cmd;

//Load setpoint for valve transition.
L T#3s;
T #SQ_TIMER.PT;

//Start timer.
SET;
S #sqSeqTimerStart;
Verification:- //Valve 01 opened.
A(;
L "dbCONST".BLK.POSx.STATE.OPENED;
L  #_pos_sprayball1_state;
==I;
);


--------------------------------------------------
ACTION::03
--------------------------------------------------
Description:- Wait for transition timer
Action:- NOP 0;
Verification:- A #SQ_TIMER.Q;

--------------------------------------------------
ACTION::04
--------------------------------------------------
Description:- Reset the timer
Action:- SET;
R #sqSeqTimerStart;
Verification:- AN #SQ_TIMER.Q;

--------------------------------------------------
ACTION::05
--------------------------------------------------
Description:- Close valve 1
Action:- //Close valve 1
L "dbCONST".BLK.POSx.CMD.CLOSE;
T  #_pos_sprayball1_cmd;
Verification:- //Valve 1 closed.
A(;
L "dbCONST".BLK.POSx.STATE.CLOSED; 
L #_pos_sprayball1_state;
==I;
);

--------------------------------------------------
ACTION::06
--------------------------------------------------
Description:- Start the valve opened timer
Action:- //Load setpoint for valve open duration.
L #_opened_time;
T #SQ_TIMER.PT;

//Start timer.
SET;
S #sqSeqTimerStart;


--------------------------------------------------
TRANSITION::03
--------------------------------------------------
TRNNo:- 3.0000
Title:- Last Step never jump
EmptyTransition:- False
Description:- Last Step will never be true
Condition:- AN "uncondJump";


--------------------------------------------------
TRANSITION::04
--------------------------------------------------
TRNNo:- 4.0000
Title:- Wait until timer expired
EmptyTransition:- False
Description:- Wait until delay time expired
Condition:- A #SQ_TIMER.Q; 


--------------------------------------------------
STEP::04
--------------------------------------------------
StepNo:- 4.0000
Title:- PH_EMV2_PULSE : Last Step
Description:- Close sprayball 1 and 2.
Log PULSE operation end time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Close sprayball 1 and 2.
Log PULSE operation end time.
Action:- SET;
R #sqSeqTimerStart;

//Close sprayball 1 and 2.
L "dbCONST".BLK.POSx.CMD.CLOSE;
T  #_pos_sprayball1_cmd;
T  #_pos_sprayball2_cmd;


//Log PULSE operation end time.
SET;
S #_log_msg_pulse_end;
Verification:- A "uncondJump";

****************************************************************************************************
END SSS REPORT
****************************************************************************************************
