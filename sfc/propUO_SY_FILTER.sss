****************************************************************************************************
SEQUENCE STEP SCHEDULE
generated on 10/11/2018 5:50:32 PM by David Paspa
****************************************************************************************************





--------------------------------------------------
SEQUENCE
--------------------------------------------------

SFCNo:- 4
Title:- UO_SY_FILTER
Description:- Sequence for receipt of product Filtration from Manufacturing Vessel Mx into Storage Vessel Sy.
Name:- FILTER
Class:- SY
Level:- UO
STEP_LIST_FORMAT:- JU    S0@@STEP_NUM@@; // STEP-0@@STEP_NUM@@:
ACT_LIST_FORMAT:- JU    @@ACT_CODE@@@@STEP_NUM@@; //ACTION-@@ACT_NUM@@
HeaderName:- SUFILT
Version:- 0.1
RevisionHistory:- // SFC Revision History:
// Rev By               Date        CC         Note
// 0.1 Gerald Kontriner 14-Sep-2009            SFC structural design
HMI_FORMAT:- @@STEP_NUM_INT@@,@@STEP_TITLE@@

--------------------------------------------------
PARAMETER::1
--------------------------------------------------
Name:- emx_transfer_hygiene
Type:- INT
Description:- Description
ParameterInOut:- IN_OUT

--------------------------------------------------
PARAMETER::2
--------------------------------------------------
Name:- emx_smfl_hygiene
Type:- INT
Description:- Description
ParameterInOut:- IN_OUT

--------------------------------------------------
PARAMETER::3
--------------------------------------------------
Name:- emx_smfldrn_hygiene
Type:- INT
Description:- Description
ParameterInOut:- IN_OUT

--------------------------------------------------
PARAMETER::4
--------------------------------------------------
Name:- vessel_sy
Type:- INT
Description:- Storage vessel selection S1 or S2
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::5
--------------------------------------------------
Name:- vessel_mx
Type:- INT
Description:- Manufacturing vessel selection M1 or M2
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::6
--------------------------------------------------
Name:- log_msg_filter_begin
Type:- BOOL
Description:- UO_SY_FILTER begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::7
--------------------------------------------------
Name:- log_msg_filter_end
Type:- BOOL
Description:- UO_SY_FILTER end time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::8
--------------------------------------------------
Name:- r_pres_lpca_purge
Type:- REAL
Description:- Pressure LPCA purge after filtration complete
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::9
--------------------------------------------------
Name:- emc_water_sy_state
Type:- INT
Description:- Device state of emc_water
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::10
--------------------------------------------------
Name:- emc_water_sy_subs
Type:- INT
Description:- Substate selection to emc_water
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::11
--------------------------------------------------
Name:- emc_water_sy_cmd
Type:- INT
Description:- Command to emc_water
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::12
--------------------------------------------------
Name:- emv_vessel_state
Type:- INT
Description:- Device state of emv_vessel
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::13
--------------------------------------------------
Name:- emv_vessel_subs
Type:- INT
Description:- Substate selection to emv_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::14
--------------------------------------------------
Name:- emv_vessel_cmd
Type:- INT
Description:- Command to emv_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::15
--------------------------------------------------
Name:- emc_gas_setpoint
Type:- REAL
Description:- Setpoint to emc_gas
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::16
--------------------------------------------------
Name:- emc_gas_medium_gas
Type:- INT
Description:- emc_gas medium
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::17
--------------------------------------------------
Name:- emc_gas_state
Type:- INT
Description:- Device State of emc_gas
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::18
--------------------------------------------------
Name:- emc_gas_subs
Type:- INT
Description:- Substate selection to emc_gas
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::19
--------------------------------------------------
Name:- emc_gas_cmd
Type:- INT
Description:- Command to emc_gas
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::20
--------------------------------------------------
Name:- sync_read_filtration_complete
Type:- BOOL
Description:- Filtration complete flag
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::21
--------------------------------------------------
Name:- sync_write_path_ready
Type:- BOOL
Description:- Indicates flow path has been opened
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::22
--------------------------------------------------
Name:- r_time_lpca_purge
Type:- Time
Description:- Time setting for LPCA purging
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::23
--------------------------------------------------
Name:- r_pres_lpca_blanket
Type:- REAL
Description:- Pressure LPCA blanket
ParameterInOut:- VAR


--------------------------------------------------
STEP::01
--------------------------------------------------
StepNo:- 01
Title:- UO_SY_FILTER : Filtration Unit Operation Commenced
Description:- Log Sy Filter operation begin time.
Open Sy vent valve without LPCA control.
Set Sy Outlet valve open (STATE=DISCHARGE).
Set remaining Sy equipment to SAFE state.

Set flag path_ready.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Reset EMs
Action:- // Set remaining Sy equipment to SAFE state:
L "dbCONST".BLK.CMD.STOP;
T #_emv_vessel_cmd;
T  #_emc_water_sy_cmd;
T  #_emc_gas_cmd;
Verification:- A(;
L   #_emv_vessel_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);
A(;
L   #_emc_water_sy_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);
A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Log Sy Filter operation begin time.
Open Sy vent valve without LPCA control.
Set Sy Outlet valve open (STATE=DISCHARGE).
Set remaining Sy equipment to SAFE state:

Action:- //Log Sy Filter operation begin time.
SET;
S #_log_msg_filter_begin;

// Open Sy outlet valve
L "dbCONST".BLK.EMV1.SUBS.DISCHARGE;
T #_emv_vessel_subs;
L "dbCONST".BLK.CMD.START;
T #_emv_vessel_cmd;
Verification:- A(;
L #_emc_gas_state;
L "dbCONST".BLK.STATE.STOPPED;
==I;
);
A(;
L #_emv_vessel_subs;
L "dbCONST".BLK.EMV1.SUBS.DISCHARGE;
==I;
);
A(;
L #_emc_water_sy_state;
L "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::03
--------------------------------------------------
Description:- Set flag path_ready.
Action:- // Set flag path_ready.
SET;
S #_sync_write_path_ready;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::01
--------------------------------------------------
TRNNo:- 01
Title:- Filtration complete?
EmptyTransition:- False
Description:- Wait for parent to indicate filtration transfer is complete when flag filtration_complete is set by the parent.
Condition:- A #_sync_read_filtration_complete;


--------------------------------------------------
STEP::02
--------------------------------------------------
StepNo:- 02
Title:- UO_SY_FILTER : Enable Sy LPCA control
Description:- Enable Sy LPCA control at PRES_LPCA_PURGE.

Start Timer with TIME_LPCA_PURGE.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Reset gas EM
Action:- L "dbCONST".BLK.CMD.STOP;
T #_emc_gas_cmd;
Verification:- A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Enable Sy LPCA control at PRES_LPCA_PURGE.

Start Timer with TIME_LPCA_PURGE.
Action:- //Enable Sy LPCA control at PRES_LPCA_PURGE.
L  #_r_pres_lpca_purge;
T  #_emc_gas_setpoint;
L  "dbCONST".SEL.GAS.LPCA;
T  #_emc_gas_medium_gas;
L  "dbCONST".BLK.EMC1.SUBS.PRESSURE;
T  #_emc_gas_subs;
L  "dbCONST".BLK.CMD.START;
T  #_emc_gas_cmd;


// Start Timer
A #SQ_TIMER.Q;
R #sqSeqTimerStart;

AN #SQ_TIMER.Q;
S #sqSeqTimerStart;
L #_r_time_lpca_purge;
T #SQ_TIMER.PT;
R #_sync_write_path_ready;
Verification:- A(;
L #_emc_gas_subs;
L "dbCONST".BLK.EMC1.SUBS.PRESSURE;
==I;
);
A #sqSeqTimerStart;


--------------------------------------------------
TRANSITION::02
--------------------------------------------------
TRNNo:- 02
Title:- Timer expired?
EmptyTransition:- False
Description:- Wait until TIME_LPCA_PURGE expired.
Condition:- A #SQ_TIMER.Q;


--------------------------------------------------
STEP::03
--------------------------------------------------
StepNo:- 03
Title:- UO_SY_FILTER : Adjust Sy LPCA pressure 
Description:- Adjust Sy LPCA pressure control setpoint to PRES_LPCA_BLANKET with the Vent valve closed.
Set SMFL and SVT hygiene status to USED.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Reset gas EM
Action:- L "dbCONST".BLK.CMD.STOP;
T #_emc_gas_cmd;
Verification:- A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Adjust Sy LPCA pressure control setpoint to PRES_LPCA_BLANKET with the Vent valve closed.
Set SMFL and SVT hygiene status to USED.

Action:- // Adjust Sy LPCA pressure control setpoint to PRES_LPCA_BLANKET with the Vent valve closed.
L  #_r_pres_lpca_blanket;
T  #_emc_gas_setpoint;
L  "dbCONST".SEL.GAS.LPCA;
T  #_emc_gas_medium_gas;
L  "dbCONST".BLK.EMC1.SUBS.PRESSURE;
T  #_emc_gas_subs;
L  "dbCONST".BLK.CMD.START;
T  #_emc_gas_cmd;


//Set SMFL and SVT hygiene status to USED.
L  "dbCONST".BLK.HYGIENE.USED;
T #_emx_transfer_hygiene;
T #_emx_smfl_hygiene;
T #_emx_smfldrn_hygiene;
Verification:- A(;
L #_emc_gas_subs;
L "dbCONST".BLK.EMC1.SUBS.PRESSURE;
==I;
);
A(;
L #_emv_vessel_state;
L "dbCONST".BLK.STATE.STOPPED;
==I;
);



--------------------------------------------------
TRANSITION::03
--------------------------------------------------
TRNNo:- 03
Title:- Empty Transition
EmptyTransition:- False
Description:- Jump
Condition:- A "uncondJump";


--------------------------------------------------
STEP::04
--------------------------------------------------
StepNo:- 04
Title:- UO_SY_FILTER : Filtration Unit Operation Completed
Description:- Log Sy Filter operation end time.
Set other equipment to safe state.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log Sy Filter operation end time.
Set other equipment to safe state:

Action:- // Set other equipment to safe state.
L "dbCONST".BLK.CMD.STOP;
T #_emv_vessel_cmd;

//Log Sy Filter operation end time.
SET;
S #_log_msg_filter_end;

****************************************************************************************************
END SSS REPORT
****************************************************************************************************
