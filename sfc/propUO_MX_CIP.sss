****************************************************************************************************
SEQUENCE STEP SCHEDULE
generated on 2/05/2018 5:58:43 PM by David Paspa
****************************************************************************************************





--------------------------------------------------
SEQUENCE
--------------------------------------------------

SFCNo:- 001
Title:- Manufacturing Vessel Mx CIP
Description:- Sequence for Clean In Place CIP operation
Name:- CIP
Class:- MX
Level:- UO
STEP_LIST_FORMAT:- JU    S0@@STEP_NUM@@; // STEP-0@@STEP_NUM@@:
ACT_LIST_FORMAT:- JU    @@ACT_CODE@@@@STEP_NUM@@; //ACTION-@@ACT_NUM@@
HeaderName:- MUCIP
Version:- 0.2
RevisionHistory:- // SFC Revision History:
// Rev By               Date        CC         Note
// 0.2 David Paspa      26-Oct-2009            Added synch flags
// 0.1 Gerald Kontriner 07-Sep-2009            SFC structural design
HMI_FORMAT:- @@STEP_NUM_INT@@,@@STEP_TITLE@@

--------------------------------------------------
PARAMETER::1
--------------------------------------------------
Name:- wfi_flrinse_begin_time
Type:- TOD
Description:- WFI filtration line rinse begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::2
--------------------------------------------------
Name:- wfi_flrinse_end_time
Type:- TOD
Description:- WFI filtration line rinse end time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::3
--------------------------------------------------
Name:- log_time_act_wfi_flrinse
Type:- TIME
Description:- Flags the HMI to log actual WFI filtration line rinse time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::4
--------------------------------------------------
Name:- time_act_wfi_flrinse
Type:- TIME
Description:- log actual WFI filtration line rinse time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::5
--------------------------------------------------
Name:- wfi_rinse_begin_time
Type:- TOD
Description:- WFI rinse begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::6
--------------------------------------------------
Name:- wfi_rinse_end_time
Type:- TOD
Description:- WFI rinse end time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::7
--------------------------------------------------
Name:- log_time_act_wfi_rinse
Type:- BOOL
Description:- Flags the HMI to log actual WFI rinse time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::8
--------------------------------------------------
Name:- time_act_wfi_rinse
Type:- TIME
Description:- log actual WFI rinse time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::9
--------------------------------------------------
Name:- pw_steam_begin_time
Type:- TOD
Description:- PW steaming begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::10
--------------------------------------------------
Name:- pw_steam_end_time
Type:- TOD
Description:- PW steaming end time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::11
--------------------------------------------------
Name:- log_time_act_pw_steam
Type:- BOOL
Description:- Flags the HMI to log actual PW steaming time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::12
--------------------------------------------------
Name:- time_act_pw_steam
Type:- TIME
Description:- Logging PW Steam Time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::13
--------------------------------------------------
Name:- pw_flwash_begin_time
Type:- TOD
Description:- Filtration line PW wash begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::14
--------------------------------------------------
Name:- pw_flwash_end_time
Type:- TOD
Description:- Filtration line PW wash end time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::15
--------------------------------------------------
Name:- log_time_act_pw_flwash
Type:- BOOL
Description:- Flags the HMI to log actual filtration line PW wash Time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::16
--------------------------------------------------
Name:- time_act_pw_flwash
Type:- TIME
Description:- log actual filtration line PW wash Time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::17
--------------------------------------------------
Name:- pw_wash_begin_time
Type:- TOD
Description:- PW wash begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::18
--------------------------------------------------
Name:- pw_wash_end_time
Type:- TOD
Description:- PW wash begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::19
--------------------------------------------------
Name:- log_time_act_pw_wash
Type:- BOOL
Description:- Flags the HMI to log actual PW wash Time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::20
--------------------------------------------------
Name:- time_act_pw_wash
Type:- TIME
Description:- log actual PW wash Time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::21
--------------------------------------------------
Name:- flood_mixing_begin_time
Type:- TOD
Description:- PW flood mixing begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::22
--------------------------------------------------
Name:- flood_mixing_end_time
Type:- TOD
Description:- PW flood mixing end time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::23
--------------------------------------------------
Name:- log_time_act_flood_mixing
Type:- BOOL
Description:- Flags the HMI to log actual PW Flood mixing time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::24
--------------------------------------------------
Name:- time_act_flood_mixing
Type:- TIME
Description:- Logging actual PW Flood mixing time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::25
--------------------------------------------------
Name:- log_real_pw_flood_mass
Type:- BOOL
Description:- Flags the HMI that PW flood mass has been logged
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::26
--------------------------------------------------
Name:- emm_mi_vessel_pv
Type:- REAL
Description:- Vessel Mass
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::27
--------------------------------------------------
Name:- pw_flush_end_time
Type:- TOD
Description:- PW Flush end time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::28
--------------------------------------------------
Name:- log_time_act_pw_flush
Type:- BOOL
Description:- Flags the HMI to log actual PW Flush Time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::29
--------------------------------------------------
Name:- pw_flush_begin_time
Type:- TOD
Description:- PW Flush begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::30
--------------------------------------------------
Name:- log_time_cip_end
Type:- BOOL
Description:- Flags the HMI that Mx CIP Operation ended

ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::31
--------------------------------------------------
Name:- log_time_cip_begin
Type:- BOOL
Description:- Flags the HMI that Mx CIP Operation started
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::32
--------------------------------------------------
Name:- emm_vessel_mass_tare
Type:- REAL
Description:- Saved tare mass value
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::33
--------------------------------------------------
Name:- emm_vessel_subs
Type:- INT
Description:- Substate selection to emm_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::34
--------------------------------------------------
Name:- emm_vessel_cmd
Type:- INT
Description:- Command to emm_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::35
--------------------------------------------------
Name:- emm_vessel_state
Type:- INT
Description:- Device State of emm_vessel
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::36
--------------------------------------------------
Name:- mx_vessel_agit_setpoint
Type:- REAL
Description:- Speed Setpoint for Agitator from parent
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::37
--------------------------------------------------
Name:- emc_water_runtime
Type:- TIME
Description:- run time for emc_water
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::38
--------------------------------------------------
Name:- time_act_pw_flush
Type:- TIME
Description:- Logging actual PW Flush Time.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::39
--------------------------------------------------
Name:- time_wfi_rinse_mx
Type:- TIME
Description:- Time to rinse tank outlet drain line with WFI
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::40
--------------------------------------------------
Name:- time_pw_wash_mmflx
Type:- TIME
Description:- Time to wash with PW
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::41
--------------------------------------------------
Name:- emx_mmfl_subs
Type:- INT
Description:- Substate selection to emx_mmfl
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::42
--------------------------------------------------
Name:- emx_mmfl_cmd
Type:- INT
Description:- Command to emx_mmfl
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::43
--------------------------------------------------
Name:- emx_mmfl_state
Type:- INT
Description:- Device State of emx_mmfl
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::44
--------------------------------------------------
Name:- Report_Evnt_010
Type:- BOOL
Description:- WFI Rinse End for batch report
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::45
--------------------------------------------------
Name:- Report_Evnt_009
Type:- BOOL
Description:- WFI Rinse Start for batch report
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::46
--------------------------------------------------
Name:- Report_Evnt_008
Type:- BOOL
Description:- PW Wash End for batch report
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::47
--------------------------------------------------
Name:- Report_Evnt_007
Type:- BOOL
Description:- PW Wash Start for batch report
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::48
--------------------------------------------------
Name:- Report_Evnt_006
Type:- BOOL
Description:- PW Flood End for batch Report
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::49
--------------------------------------------------
Name:- Report_Evnt_005
Type:- BOOL
Description:- PW Flood Start for batch Report
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::50
--------------------------------------------------
Name:- Report_Evnt_004
Type:- BOOL
Description:- PW Flush End for batch Report
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::51
--------------------------------------------------
Name:- Report_Evnt_003
Type:- BOOL
Description:- PW Flush Start for Batch Report
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::52
--------------------------------------------------
Name:- real_pw_flood_mass
Type:- REAL
Description:- Logging PW Flood Mass.
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::53
--------------------------------------------------
Name:- log_msg_pw_flood_timeout
Type:- BOOL
Description:- Logging PW Flood Timeout
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::54
--------------------------------------------------
Name:- ema_vessel_runtime_s
Type:- INT
Description:- Agitator run time Seconds for ema_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::55
--------------------------------------------------
Name:- ema_vessel_runtime_m
Type:- INT
Description:- Agitator run time Minutes for ema_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::56
--------------------------------------------------
Name:- ema_vessel_runtime_h
Type:- INT
Description:- Agitator run time Hours for ema_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::57
--------------------------------------------------
Name:- ema_vessel_setpoint
Type:- REAL
Description:- Speed Setpoint Parameter Agitator
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::58
--------------------------------------------------
Name:- emc_gas_medium
Type:- INT
Description:- emc_gas medium
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::59
--------------------------------------------------
Name:- emc_water_medium
Type:- INT
Description:- Medium selection for emc_water
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::60
--------------------------------------------------
Name:- emv_vessel_state
Type:- INT
Description:- Device State of emv_vessel
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::61
--------------------------------------------------
Name:- emv_vessel_subs
Type:- INT
Description:- Substate selection to emv_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::62
--------------------------------------------------
Name:- emv_vessel_cmd
Type:- INT
Description:- Command to emv_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::63
--------------------------------------------------
Name:- emc_water_state
Type:- INT
Description:- Device State of emc_water
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::64
--------------------------------------------------
Name:- emc_water_subs
Type:- INT
Description:- Substate selection to emc_water
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::65
--------------------------------------------------
Name:- emc_water_cmd
Type:- INT
Description:- Command to emc_water
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::66
--------------------------------------------------
Name:- emc_gas_state
Type:- INT
Description:- Device State of emc_gas
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::67
--------------------------------------------------
Name:- emc_gas_subs
Type:- INT
Description:- Substate selection to emc_gas
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::68
--------------------------------------------------
Name:- emc_gas_cmd
Type:- INT
Description:- Command to emc_gas
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::69
--------------------------------------------------
Name:- ema_vessel_state
Type:- INT
Description:- Device State of ema_vessel
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::70
--------------------------------------------------
Name:- ema_vessel_subs
Type:- INT
Description:- Substate selection to ema_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::71
--------------------------------------------------
Name:- ema_vessel_cmd
Type:- INT
Description:- Command to ema_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::72
--------------------------------------------------
Name:- time_cip_end
Type:- TOD
Description:- Logging Mx CIP Operation End Time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::73
--------------------------------------------------
Name:- time_cip_begin
Type:- TOD
Description:- Logging Mx CIP Operation Begin Time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::74
--------------------------------------------------
Name:- time_wfi_rinse_mmflx
Type:- TIME
Description:- Time to rinse filtration line with WFI
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::75
--------------------------------------------------
Name:- time_wfi_empty
Type:- TIME
Description:- Time to empty the vessel after WFI rinse
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::76
--------------------------------------------------
Name:- time_pw_steam
Type:- TIME
Description:- Time to steam PW line
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::77
--------------------------------------------------
Name:- time_pw_wash_mx
Type:- TIME
Description:- Time to wash with PW
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::78
--------------------------------------------------
Name:- time_pw_empty2
Type:- TIME
Description:- Time to empty the vessel after washing
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::79
--------------------------------------------------
Name:- time_pw_empty1
Type:- TIME
Description:- Time to empty the vessel after flooding
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::80
--------------------------------------------------
Name:- time_pw_agit
Type:- TIME
Description:- Mixing time for flooded agitator
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::81
--------------------------------------------------
Name:- time_pw_flood
Type:- TIME
Description:- Timeout for PW Flood Stage
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::82
--------------------------------------------------
Name:- time_pw_flush
Type:- TIME
Description:- Flushing time for PW pre-stage
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::83
--------------------------------------------------
Name:- mass_pw_flood
Type:- REAL
Description:- PW Mass Value Limit
ParameterInOut:- IN


--------------------------------------------------
STEP::01
--------------------------------------------------
StepNo:- 01
Title:- UO_MX_CIP : Unit Operation Commenced
Description:- Log Mx CIP operation begin time.
Start Mass Tare operation.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log Mx CIP operation begin time.
Start Mass Tare operation.
Action:- //Log Mx CIP operation begin time.
L "dbCONST".CHRONO.CPU_TIME;
T #_time_cip_begin;

SET;
S #_log_time_cip_begin;

//Start Mass Tare.
L "dbCONST".BLK.EMM1.SUBS.TARE;
T #_emm_vessel_subs;
L "dbCONST".BLK.CMD.START;
T #_emm_vessel_cmd;
Verification:- //Verify emv_vessel changed to substate DISCHARGE.
A(;
L #_emm_vessel_state;
L "dbCONST".BLK.EMM1.SUBS.TARE;
==I;
);


--------------------------------------------------
TRANSITION::01
--------------------------------------------------
TRNNo:- 01
Title:- TARE complete?
EmptyTransition:- False
Description:- Emm_vessel substate TARE is complete
Condition:- A(;
L   #_emm_vessel_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);


--------------------------------------------------
STEP::02
--------------------------------------------------
StepNo:- 02
Title:- UO_MX_CIP : Open tank path to outlet drain line.
Description:- Open tank path to outlet drain line.
Open Mx outlet valve (DISCHARGE).

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Set emv_vessel to substate DISCHARGE. 
Open tank path to outlet drain line.
Action:- //Open Mx outlet valve.
L "dbCONST".BLK.EMV1.SUBS.DISCHARGE;
T #_emv_vessel_subs;
L "dbCONST".BLK.CMD.START;
T #_emv_vessel_cmd;

// Set emx_mmfl to substate CIP_MX and start it.
L "dbCONST".BLK.EMX1.SUBS.CIP_MX;
T #_emx_mmfl_subs;
L "dbCONST".BLK.CMD.START;
T #_emx_mmfl_cmd;

//Reset Batch Report Event
SET;
R #_Report_Evnt_003;
R #_Report_Evnt_004;
R #_Report_Evnt_005;
R #_Report_Evnt_006;
R #_Report_Evnt_007;
R #_Report_Evnt_008;
R #_Report_Evnt_009;
R #_Report_Evnt_010;

Verification:- //Verify emv_vessel changed to substate DISCHARGE.
A(;
L    #_emv_vessel_state;
L    "dbCONST".BLK.EMV1.SUBS.DISCHARGE;
==I;
);
//Verify if emx_mmfl changed to substate CIP_MX.
A(;
L   #_emx_mmfl_state;
L   "dbCONST".BLK.EMX1.SUBS.CIP_MX;
==I;
);


--------------------------------------------------
STEP::03
--------------------------------------------------
StepNo:- 03
Title:- UO_MX_CIP : Commence PW Preflush of vessel
Description:- Open HPCA supply valve and open PW supply to preflush vessel with time_pw_flush timer.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Open HPCA supply valve.
Action:- // Open HPCA supply valve.
L "dbCONST".SEL.GAS.HPCA;
T #_emc_gas_medium;
L "dbCONST".BLK.EMC1.SUBS.PRESSURE;
T #_emc_gas_subs;
L "dbCONST".BLK.CMD.START;
T #_emc_gas_cmd;
Verification:- //Verify if CA valve opened.
A(;
L     #_emc_gas_state;
L     "dbCONST".BLK.EMC1.SUBS.PRESSURE;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Preflush vessel.
Load flushing time and start PW flush.
Action:- // Load flushing time for PW pre-stage.
L #_time_pw_flush;
T #_emc_water_runtime;

//Set emc_water to substate FLUSH and open PW supply valve.
L "dbCONST".SEL.LIQUID.PW;
T #_emc_water_medium;
L "dbCONST".BLK.EMC2.SUBS.FLUSH;
T #_emc_water_subs;
L "dbCONST".BLK.CMD.START;
T #_emc_water_cmd;

//Report Event Set
SET;
S #_Report_Evnt_003;

//Store PW Flush begin time.
L "dbCONST".CHRONO.CPU_TIME;
T #_pw_flush_begin_time;
Verification:- //Verify if emc_water changed to substate FLUSH.
A(;
L   #_emc_water_state;
L   "dbCONST".BLK.EMC2.SUBS.FLUSH;
==I;
);


--------------------------------------------------
TRANSITION::03
--------------------------------------------------
TRNNo:- 03
Title:- Pre-flush time expired.
EmptyTransition:- False
Description:- Tank flushed for time_pw_flush expired.
Condition:- A(;
L   #_emc_water_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);



--------------------------------------------------
STEP::04
--------------------------------------------------
StepNo:- 04
Title:- UO_MX_CIP : Close MX outlet to flood vessel.
Description:- Log actual PW flush time.
Close Mx outlet valve.
Close HPCA supply valve.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log actual PW flush time.
Close Mx outlet valve.
Close HPCA supply valve.
Action:- //Store PW Flush end time.
L "dbCONST".CHRONO.CPU_TIME;
T #_pw_flush_end_time;

//Log actual PW flush time.
CALL T_DIFF
{date_type := 'Time_Of_Day', time_type := 'Time'}
(  IN1                         := #_pw_flush_begin_time ,
   IN2                         := #_pw_flush_end_time ,
  OUT                         := #_time_act_pw_flush
);

SET;
S #_log_time_act_pw_flush;


// Close Mx outlet valve.
L "dbCONST".BLK.SAFE.CMD;
T  #_emv_vessel_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_emv_vessel_cmd;

//Set substate to safe state and stop emc_gas.
L "dbCONST".BLK.SAFE.CMD;
T  #_emc_gas_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_emc_gas_cmd;

//Report Event Set
SET;
S #_Report_Evnt_004;
Verification:- //Verify if emv_vessel & emc_gas stopped.
A(;
L #_emv_vessel_state;
L "dbCONST".BLK.STATE.STOPPED;
==I;
);
A(;
L #_emc_gas_state;
L "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Initialize timer.
Action:- A #SQ_TIMER.Q;
R #SQ_TIMER.IN;

AN #SQ_TIMER.Q;
S #SQ_TIMER.IN;
L T#10S;
T #SQ_TIMER.PT;
Verification:- A #SQ_TIMER.IN;


--------------------------------------------------
TRANSITION::04
--------------------------------------------------
TRNNo:- 04
Title:- Timer
EmptyTransition:- False
Description:- TBD on delay timer
Condition:- A #SQ_TIMER.Q;


--------------------------------------------------
STEP::05
--------------------------------------------------
StepNo:- 05
Title:- UO_MX_CIP : PW Flood mixing.
Description:- Enable Mx Agitator. (TIME RUN HOUR=1)
Store mixing begin time.
Start TIME_PW_AGIT timer.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Enable Mx Agitator EAn010 (STATE=MIX, TIME RUN HOUR=1)
Action:- // Load setpoint and enable Mx Agitator.
L #_mx_vessel_agit_setpoint; 
T #_ema_vessel_setpoint;
L 1;
T #_ema_vessel_runtime_h;
L 0;
T #_ema_vessel_runtime_m;
L 0;
T #_ema_vessel_runtime_s;

L "dbCONST".BLK.EMA1.SUBS.MIX;
T #_ema_vessel_subs;
L "dbCONST".BLK.CMD.START;
T #_ema_vessel_cmd;
Verification:- A(;
L  #_ema_vessel_state;
L "dbCONST".BLK.EMA1.SUBS.MIX;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Re-initilialize timer.
Store mixing begin time.
Action:- A #SQ_TIMER.Q;
R #SQ_TIMER.IN;

AN #SQ_TIMER.Q;
S #SQ_TIMER.IN;
L #_time_pw_agit;
T #SQ_TIMER.PT;

//Store flood mixing begin time.
L "dbCONST".CHRONO.CPU_TIME;
T #_flood_mixing_begin_time;
Verification:- A #SQ_TIMER.IN;


--------------------------------------------------
TRANSITION::05
--------------------------------------------------
TRNNo:- 05
Title:- Empty Transition
EmptyTransition:- False
Description:- Jump
Condition:- A M1.1; //Always High flag


--------------------------------------------------
STEP::06
--------------------------------------------------
StepNo:- 06
Title:- MX_UO_CIP : Wait to reach vessel flood mass
Description:- Start PW FLUSH and CHARGE.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Set medium to PW and start FLUSH.
Action:- //Set emc_water to substate FLUSH and open PW supply valve.
L "dbCONST".SEL.LIQUID.PW;
T #_emc_water_medium;
L #_time_pw_flood;
T #_emc_water_timeout;

//Load Mass to charge vessel.
L #_mass_pw_flood;
T #_emc_water_mass;

//Start Charge
L "dbCONST".BLK.EMC2.SUBS.CHARGE;
T #_emc_water_subs;
L "dbCONST".BLK.CMD.START;
T #_emc_water_cmd;
Verification:- //Verify if emc_water changed to substate CHARGE.
A(;
L   #_emc_water_state;
L   "dbCONST".BLK.EMC2.SUBS.CHARGE;
==I;
);


--------------------------------------------------
TRANSITION::06
--------------------------------------------------
TRNNo:- 06
Title:- CHARGE completed.
EmptyTransition:- False
Description:- CHARGE completed and TIME_PW_AGIT expired.
Condition:- A(;
L   #_emc_water_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);
A #SQ_TIMER.Q;


--------------------------------------------------
STEP::07
--------------------------------------------------
StepNo:- 07
Title:- UO_MX_CIP : Disable Agitator
Description:- Disable Agitator and open Mx outlet valve.
Log actual tank PW flood mixing time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Disable agitator.
Open Mx outlet valve.
Store mixing begin time.
Action:- // Disable Mx Agitator
L "dbCONST".BLK.SAFE.CMD;
T #_ema_vessel_subs;
L "dbCONST".BLK.CMD.STOP;
T #_ema_vessel_cmd;

//Open Mx outlet valve.
L "dbCONST".BLK.EMV1.SUBS.DISCHARGE;
T #_emv_vessel_subs;
L "dbCONST".BLK.CMD.START;
T #_emv_vessel_cmd;

//Store PW Flood mixing end time.
L "dbCONST".CHRONO.CPU_TIME;
T #_flood_mixing_end_time;

//Log actual PW Flood mixing time.
CALL T_DIFF
{date_type := 'Time_Of_Day', time_type := 'Time'}
(  IN1                         := #_flood_mixing_begin_time ,
   IN2                         := #_flood_mixing_end_time ,
  OUT                         := #_time_act_flood_mixing
);
SET;
S #_log_time_act_flood_mixing;

Verification:- A(;
L #_ema_vessel_state;
L "dbCONST".BLK.STATE.STOPPED;
==I;
);
A(;
L #_emm_vessel_state;
L "dbCONST".BLK.EMV1.SUBS.DISCHARGE;
==I;
);


--------------------------------------------------
TRANSITION::07
--------------------------------------------------
TRNNo:- 07
Title:- Empty Transition
EmptyTransition:- False
Description:- Jump
Condition:- A M1.1; //Always High flag


--------------------------------------------------
STEP::08
--------------------------------------------------
StepNo:- 08
Title:- UO_MX_CIP : Wait to empty vessel
Description:- Open HPCA supply valve.
Start timer for PW Empty.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Open HPCA supply valve.
Action:- // Open HPCA supply valve.
L "dbCONST".SEL.GAS.HPCA;
T #_emc_gas_medium;
L "dbCONST".BLK.EMC1.SUBS.VALVE;
T #_emc_gas_sub;
L "dbCONST".BLK.CMD.START;  
T #_emc_gas_cmd;
Verification:- A(;
L #_emc_gas_state;
L "dbCONST".BLK.EMC1.SUBS.VALVE;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Load time to empty vessel after flooding.
Action:- //Start timer for PW Empty.
A #SQ_TIMER.Q;
R #SQ_TIMER.IN;

AN #SQ_TIMER.Q;
S #SQ_TIMER.IN;
L #_time_pw_empty1;
T #SQ_TIMER.PT;
Verification:- A #SQ_TIMER.IN;


--------------------------------------------------
TRANSITION::08
--------------------------------------------------
TRNNo:- 08
Title:- Timer expired.
EmptyTransition:- False
Description:- TIME_PW_EMPTY1 expired?
Condition:- A #SQ_TIMER.Q;


--------------------------------------------------
STEP::09
--------------------------------------------------
StepNo:- 09
Title:- UO_MX_CIP : Commence vessel washing with PW
Description:- Open PW supply to wash vessel and start FLUSH.
Store PW wash begin time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Open PW supply to wash vessel.
Load Time to wash with PW.
Store PW wash begin time.
Action:- //Set emc_water to substate FLUSH and open PW supply valve.
L "dbCONST".SEL.LIQUID.PW;
T #_emc_water_medium;
L "dbCONST".BLK.EMC2.SUBS.FLUSH;
T #_emc_water_subs;
L "dbCONST".BLK.CMD.START;
T #_emc_water_cmd;


L #_time_pw_wash_mx;
T #_emc_water_runtime;   //RunTimeECn00


//Report Event Set
SET;
S #_Report_Evnt_007;


//Store PW wash begin time.
L "dbCONST".CHRONO.CPU_TIME;
T #_pw_wash_begin_time;

Verification:- //Verify if emc_water changed to substate FLUSH.
A(;
L   #_emc_water_state;
L   "dbCONST".BLK.EMC2.SUBS.FLUSH;
==I;
);


--------------------------------------------------
TRANSITION::09
--------------------------------------------------
TRNNo:- 09
Title:- Timer expired.
EmptyTransition:- False
Description:- TIME_PW_WASH_Mx expired?
Condition:- A(;
L   #_emc_water_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);


--------------------------------------------------
STEP::10
--------------------------------------------------
StepNo:- 10
Title:- UO_MX_CIP : PW washing completed
Description:- Log actual tank PW wash time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log actual tank PW wash time.
Action:- //Store PW wash end time.
L "dbCONST".CHRONO.CPU_TIME;
T #_pw_wash_end_time;


//Log actual tank PW wash time
CALL T_DIFF
{date_type := 'Time_Of_Day', time_type := 'Time'}
(  IN1                         := #_pw_wash_begin_time ,
   IN2                         := #_pw_wash_end_time ,
  OUT                         := #_time_act_pw_wash
);
SET;
S #_log_time_act_pw_wash;

//Report Event Set
SET;
S #_Report_Evnt_008;
Verification:- A M1.1; //Always High flag


--------------------------------------------------
TRANSITION::10
--------------------------------------------------
TRNNo:- 10
Title:- Empty Transition
EmptyTransition:- False
Description:- Empty Transition
Condition:- A M1.1; //Always High flag


--------------------------------------------------
STEP::11
--------------------------------------------------
StepNo:- 11
Title:- UO_MX_CIP : Divert Wash to MMFLx
Description:- Divert Wash to MMFLx.
Start TIME_PW_WASH_MMFLx.
Store PW filtration wash begin time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Divert to MMFLx Filtration Line.
Action:- // Set emx_mmfl to substate CIP_MMFLX and start it.
L "dbCONST".BLK.EMX1.SUBS.CIP_MMFLX;
T #_emx_mmfl_subs;
L "dbCONST".BLK.CMD.START;
T #_emx_mmfl_cmd;
Verification:- //Verify if emx_mmfl changed to substate CIP_MMFLX.
A(;
L   #_emx_mmfl_state;
L   "dbCONST".BLK.EMX1.SUBS.CIP_MMFLX;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Start FLUSH PW with TIME_PW_WASH_MMFLx timer.
Store PW filtration wash begin time.
Action:- //Set emc_water to substate FLUSH and open PW supply valve.
L "dbCONST".SEL.LIQUID.PW;
T #_emc_water_medium;
L "dbCONST".BLK.EMC2.SUBS.FLUSH;
T #_emc_water_subs;
L "dbCONST".BLK.CMD.START;
T #_emc_water_cmd;

L #_time_pw_wash_mmflx;
T #_emc_water_runtime;   //RunTimeECn001


//Store PW filtration wash begin time.
L "dbCONST".CHRONO.CPU_TIME;
T #_pw_flwash_begin_time;
Verification:- //Verify if emc_water changed to substate FLUSH.
A(;
L   #_emc_water_state;
L   "dbCONST".BLK.EMC2.SUBS.FLUSH;
==I;
);


--------------------------------------------------
TRANSITION::11
--------------------------------------------------
TRNNo:- 11
Title:- Timer expired.
EmptyTransition:- False
Description:- TIME_PW_WASH_MMFLx expired?
Condition:- A(;
L   #_emc_water_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);


--------------------------------------------------
STEP::12
--------------------------------------------------
StepNo:- 12
Title:- UO_MX_CIP : Filtration line PW wash completed
Description:- Log actual Filtration line PW wash time and close PW supply valve.
Start TIME_PW_EMPTY2.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log actual Filtration line PW wash time and close PW supply valve.
Action:- //Store PW filtration wash end time.
L "dbCONST".CHRONO.CPU_TIME;
T #_pw_flwash_end_time;

//Log actual filtration line PW wash time.
CALL T_DIFF
{date_type := 'Time_Of_Day', time_type := 'Time'}
(  IN1                         := #_pw_flwash_begin_time ,
   IN2                         := #_pw_flwash_end_time ,
  OUT                         := #_time_act_pw_flwash
);
SET;
S #_log_time_act_pw_flwash;

//Close PW supply valve.
L "dbCONST".BLK.SAFE.CMD;
T  #_emc_water_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_emc_water_cmd;

//Report Event Set
SET;
S #_Report_Evnt_008;
Verification:- //Verify if emc_water stopped.
A(;
L    #_emc_water_state;
L    "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Start Timer for PW Empty
Action:- //Start Timer for PW Empty
A #SQ_TIMER.Q;
R #SQ_TIMER.IN;

AN #SQ_TIMER.Q;
S #SQ_TIMER.IN;
L #_time_pw_empty2;
T #SQ_TIMER.PT;
Verification:- A #SQ_TIMER.IN;


--------------------------------------------------
TRANSITION::12
--------------------------------------------------
TRNNo:- 12
Title:- Timer expired
EmptyTransition:- False
Description:- #TIME_PW_EMPTY2 expired?
Condition:- A #SQ_TIMER.Q;


--------------------------------------------------
STEP::13
--------------------------------------------------
StepNo:- 13
Title:- MX_UO_CIP : Steaming PW inlet line
Description:- Close HPCA supply valve(vent opened) and open PW line PS supply valve with Timer TIME_PW_STEAM.
Store PW steaming begin time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Close CA supply valve.Vent opened.
Action:- // Close CA supply valve.
L "dbCONST".BLK.SAFE.CMD;
T  #_emc_gas_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_emc_gas_cmd;
Verification:- //Verify if CA suppy valve closed.
A(;
L #_emc_gas_state;
L "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Open PW line PS supply valve with Timer TIME_PW_STEAM.
Store PW steaming begin time.
Action:- //Open PW line PS supply valve
L #_time_pw_steam;
T #_emc_water_runtime;  //RunTimeECn001

L "dbCONST".SEL.LIQUID.PSPW;
T #_emc_water_medium;
L "dbCONST".BLK.EMC2.SUBS.FLUSH;
T #_emc_water_subs;
L "dbCONST".BLK.CMD.START;
T #_emc_water_cmd;


//Store PW steaming begin time.
L "dbCONST".CHRONO.CPU_TIME;
T #_pw_steam_begin_time;
Verification:- //Verify if emc_water changed to substate FLUSH.
A(;
L   #_emc_water_state;
L   "dbCONST".BLK.EMC2.SUBS.FLUSH;
==I;
);


--------------------------------------------------
TRANSITION::13
--------------------------------------------------
TRNNo:- 13
Title:- Timer Expired?
EmptyTransition:- False
Description:- TIME_PW_STEAM expired?
Condition:- //PW-PS FLUSH completed.
A(;
L   #_emc_water_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);


--------------------------------------------------
STEP::14
--------------------------------------------------
StepNo:- 14
Title:- UO_MX_CIP : Stop Steaming PW inlet line
Description:- Log actual PW line steaming time.
Close PW line PS supply valve.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Close PW-line CS supply valve.
Log actual PW line steaming time.
Action:- //Close PW line PS supply valve
L "dbCONST".BLK.SAFE.CMD;
T  #_emc_water_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_emc_water_cmd;


//Store PW Flush end time.
L "dbCONST".CHRONO.CPU_TIME;
T #_pw_steam_end_time;

//Log actual PW line steaming time.
CALL T_DIFF
{date_type := 'Time_Of_Day', time_type := 'Time'}
(  IN1                         := #_pw_steam_begin_time ,
   IN2                         := #_pw_steam_end_time ,
  OUT                         := #_time_act_pw_steam
);
SET;
S #_log_time_act_pw_steam;
Verification:- A(;
L #_emc_water_state;
L "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Start Timer for PS Steam
Action:- //Start Timer for 10s.
A #SQ_TIMER.Q;
R #SQ_TIMER.IN;

AN #SQ_TIMER.Q;
S #SQ_TIMER.IN;
L T#10S;
T #SQ_TIMER.PT;
Verification:- A #SQ_TIMER.IN;


--------------------------------------------------
TRANSITION::14
--------------------------------------------------
TRNNo:- 14
Title:- Timer
EmptyTransition:- False
Description:- Timer 10s
Condition:- A #SQ_TIMER.Q;


--------------------------------------------------
STEP::15
--------------------------------------------------
StepNo:- 15
Title:- MX_UO_CIP : Wait for OPER to setup for WFI
Description:- Setup for WFI addition to vessel. Start EMC2_SETUP with MEDIUM WFI.
Open outlet valve.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- SETUP for WFI addition.
Action:- //Set to MEDIUM WFI and start SETUP substate.
L "dbCONST".SEL.LIQUID.WFI;
T #_emc_water_medium;
L "dbCONST".BLK.EMC2.SUBS.SETUP;
T #_emc_water_subs;
L "dbCONST".BLK.CMD.START;
T #_emc_water_cmd;
Verification:- //Verify if emc_water changed to substate SETUP.
A(;
L #_emc_water_state;
L "dbCONST".BLK.EMC2.SUBS.SETUP;
==I;
);


--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Open Discharge
Action:- //Open Discharge.
L   "dbCONST".BLK.EMV1.SUBS.DISCHARGE;
T   #_emv_vessel_subs;
L   "dbCONST".BLK.CMD.START;
T   #_emv_vessel_cmd;
Verification:- A(;
L 	#_emv_vessel_state;
L 	"dbCONST".BLK.EMV1.SUBS.DISCHARGE;
==I;
);


--------------------------------------------------
TRANSITION::15
--------------------------------------------------
TRNNo:- 15
Title:- Setup ready for WFI addition.
EmptyTransition:- False
Description:- WFI addition SETUP completed.
Condition:- A(;
L   #_emc_water_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);


--------------------------------------------------
STEP::16
--------------------------------------------------
StepNo:- 16
Title:- UO_MX_CIP : Commence WFI Rinse
Description:- Divert to tank outlet drain line.
Open WFI supply valve to rinse vessel and open HPCA supply valve.
Store WFI rinse begin time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Divert to tank outlet drain line. (CIP_MX)
Action:- // Set emx_mmfl to substate CIP_MX and start it.
L "dbCONST".BLK.EMX1.SUBS.CIP_MX;
T #_emx_mmfl_subs;
L "dbCONST".BLK.CMD.START;
T #_emx_mmfl_cmd;
Verification:- //Verify if emx_mmfl changed to substate CIP_MX.
A(;
L   #_emx_mmfl_state;
L   "dbCONST".BLK.EMX1.SUBS.CIP_MX;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Open HPCA supply valve.
Action:- //Open HPCA supply valve.
L "dbCONST".SEL.GAS.HPCA;
T #_emc_gas_medium;
L "dbCONST".BLK.EMC1.SUBS.VALVE; 
T #_emc_gas_sub;
L "dbCONST".BLK.CMD.START;
T #_emc_gas_cmd;
Verification:- //Verify if CA supply valve opened.
A(;
L #_emc_gas_state;
L "dbCONST".BLK.EMC1.SUBS.VALVE; 
==I;
);

--------------------------------------------------
ACTION::03
--------------------------------------------------
Description:- Open WFI supply valve with TIME_WFI_RINSE timer.
Store WFI rinse begin time.
Action:- //Set to MEDIUM WFI and open WFI supply valve
L #_time_wfi_rinse_mx;
T #_emc_water_runtime;  //RunTimeECn001

L "dbCONST".SEL.LIQUID.WFI;
T #_emc_water_medium;
L "dbCONST".BLK.EMC2.SUBS.FLUSH;
T #_emc_water_subs;
L "dbCONST".BLK.CMD.START;
T #_emc_water_cmd;

//Report Event Set
SET;
S #_Report_Evnt_009;

//Store WFI rinse begin time.
L "dbCONST".CHRONO.CPU_TIME;
T #_wfi_rinse_begin_time;
Verification:- //Verify if emc_water changed to FLUSH substate.
A(;
L #_emc_water_state;
L "dbCONST".BLK.EMC2.SUBS.FLUSH;
==I;
);


--------------------------------------------------
TRANSITION::16
--------------------------------------------------
TRNNo:- 16
Title:- Timer Expired?
EmptyTransition:- False
Description:- TIME_WFI_RINSE_Mx expired?
Condition:- //Continue if FLUSH completed and TIME_WFI_RINSE_Mx finished.
A(;
L   #_emc_water_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);


--------------------------------------------------
STEP::17
--------------------------------------------------
StepNo:- 17
Title:- UO_MX_CIP : Mx_WFI_Rinse Completed
Description:- Log actual WFI rinse time. 
Divert Wash to MMFLx.

Start FLUSH WFI with TIME_WFI_RINSE_MMFLx timer.
Store WFI filtration line rinse begin time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log actual WFI rinse time. 
Divert to MMFLx Filtration Line.
Action:- //Store WFI rinse end time.
L "dbCONST".CHRONO.CPU_TIME;
T #_wfi_rinse_end_time;

//Log actual tank WFI rinse time.
CALL T_DIFF
{date_type := 'Time_Of_Day', time_type := 'Time'}
(  IN1                         := #_wfi_rinse_begin_time ,
   IN2                         := #_wfi_rinse_end_time ,
  OUT                         := #_time_act_wfi_rinse
);
SET;
S #_log_time_act_wfi_rinse;

// Set emx_mmfl to substate CIP_MMFLX and start it.
L "dbCONST".BLK.EMX1.SUBS.CIP_MMFLX;
T #_emx_mmfl_subs;
L "dbCONST".BLK.CMD.START;
T #_emx_mmfl_cmd;
Verification:- //Verify if emx_mmfl changed to substate CIP_MMFLX.
A(;
L   #_emx_mmfl_state;
L   "dbCONST".BLK.EMX1.SUBS.CIP_MMFLX;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Start FLUSH WFI with TIME_WFI_RINSE_MMFLx timer.
Store WFI filtration line rinse begin time.
Action:- //Set to MEDIUM WFI and open WFI supply valve.
L #_time_pw_wash_mmflx;
T #_emc_water_runtime;  //RunTimeECn001

L "dbCONST".SEL.LIQUID.WFI;
T #_emc_water_medium;
L "dbCONST".BLK.EMC2.SUBS.FLUSH;
T #_emc_water_subs;
L "dbCONST".BLK.CMD.START;
T #_emc_water_cmd;

//Store WFI filtration line rinse begin time.
L "dbCONST".CHRONO.CPU_TIME;
T #_wfi_flrinse_begin_time;
Verification:- //Verify if emc_water changed to FLUSH substate.
A(;
L #_emc_water_state;
L "dbCONST".BLK.EMC2.SUBS.FLUSH;
==I;
);


--------------------------------------------------
TRANSITION::17
--------------------------------------------------
TRNNo:- 17
Title:- MMFLx WFI Rinse Completed
EmptyTransition:- False
Description:- MMFLx WFI Rinse Completed
Condition:- A #SQ_TIMER.Q;


--------------------------------------------------
STEP::18
--------------------------------------------------
StepNo:- 18
Title:- UO_MX_CIP : WFI Rinse complete. Wait to empty vessel.
Description:- Log actual MMFLx WFI rinse time.
Close WFI supply valve.

Start timer to empty Tank, TIME_WFI_EMPTY.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log actual filtration line WFI Rinse time.
Close WFI supply valve and start WFI Empty timer.

Action:- //Store WFI filtration line rinse end time.
L "dbCONST".CHRONO.CPU_TIME;
T #_wfi_flrinse_end_time;

//Log actual filtration line WFI Rinse time.
CALL T_DIFF
{date_type := 'Time_Of_Day', time_type := 'Time'}
(  IN1                         := #_wfi_flrinse_begin_time ,
   IN2                         := #_wfi_flrinse_end_time ,
  OUT                         := #_time_act_wfi_flrinse
);
SET;
S #_log_time_act_wfi_flrinse;

//Close WFI supply valve.
L "dbCONST".BLK.SAFE.CMD;
T  #_emc_water_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_emc_water_cmd;

//Report Event Set
SET;
S #_Report_Evnt_010;
Verification:- A(;
L 	#_emc_water_state;
L 	"dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Start timer to empty Tank.
Action:- //Start Timer for WFI Empty
A #SQ_TIMER.Q;
R #SQ_TIMER.IN;

AN #SQ_TIMER.Q;
S #SQ_TIMER.IN;
L #_time_wfi_empty;
T #SQ_TIMER.PT;
Verification:- A #SQ_TIMER.IN;


--------------------------------------------------
TRANSITION::18
--------------------------------------------------
TRNNo:- 18
Title:- Timer Expired?
EmptyTransition:- False
Description:- TIME_WFI_EMPTY expired?
Condition:- A #SQ_TIMER.Q;


--------------------------------------------------
STEP::19
--------------------------------------------------
StepNo:- 19
Title:- UO_MX_CIP : Close HPCA supply valve
Description:- Close compressed air HPCA supply valve.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Close CA supply valve.
Action:- // Close CA supply valve
L "dbCONST".BLK.SAFE.CMD;
T  #_emc_gas_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_emc_gas_cmd;
Verification:- //Verify if HPCA supply valve closed.
A(;
L 	#_emc_gas_state;
L 	"dbCONST".BLK.STATE.STOPPED;
==I;
);


--------------------------------------------------
TRANSITION::19
--------------------------------------------------
TRNNo:- 19
Title:- Empty Transition
EmptyTransition:- False
Description:- Jump
Condition:- A M1.1; //Always High flag


--------------------------------------------------
STEP::20
--------------------------------------------------
StepNo:- 20
Title:- UO_MX_CIP : Unit Operation Completed
Description:- Set all used equipment modules to safe state.
Log Mx CIP operation end time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Set all used equipment modules to safe state.
Log Mx CIP operation end time.
Action:- // Set all used equipment to safe state.
L "dbCONST".BLK.SAFE.CMD;
T  #_ema_vessel_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_ema_vessel_cmd;

L "dbCONST".BLK.SAFE.CMD;
T  #_emm_vessel_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_emm_vessel_cmd;

L "dbCONST".BLK.SAFE.CMD;
T  #_emc_gas_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_emc_gas_cmd;

L "dbCONST".BLK.SAFE.CMD;
T  #_emc_water_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_emc_water_cmd;

L "dbCONST".BLK.SAFE.CMD;
T  #_emx_mmfl_subs;
L "dbCONST".BLK.CMD.STOP;
T  #_emx_mmfl_cmd;

A #_prompt_no_pw_confirm_no;
SET;
S #_log_msg_no_pw_confirm_no;


//Reset Batch Report Event
SET;
R #_Report_Evnt_003;
R #_Report_Evnt_004;
R #_Report_Evnt_005;
R #_Report_Evnt_006;
R #_Report_Evnt_007;
R #_Report_Evnt_008;
R #_Report_Evnt_009;
R #_Report_Evnt_010;

// Log Mx CIP operation end time.
L "dbCONST".CHRONO.CPU_TIME;
T #_time_cip_end;

SET;
S #_log_time_cip_end;
Verification:- A M1.1;


****************************************************************************************************
END SSS REPORT
****************************************************************************************************
