****************************************************************************************************
SEQUENCE STEP SCHEDULE
generated on 9/01/2019 4:01:49 PM by David Paspa
****************************************************************************************************





--------------------------------------------------
SEQUENCE
--------------------------------------------------

SFCNo:- 2
Title:- UO_MX_SETUP
Description:- Unit Operation for setup of equipment for manufacturing operations.
Name:- SETUP
Class:- MX
Level:- UO
STEP_LIST_FORMAT:- JU    S0@@STEP_NUM@@; // STEP-0@@STEP_NUM@@:
ACT_LIST_FORMAT:- JU    @@ACT_CODE@@@@STEP_NUM@@; //ACTION-@@ACT_NUM@@
HeaderName:- MX_SETUP
Version:- 2.0
RevisionHistory:- // SFC Revision History:
// Rev By               Date        CC         Note
// 2.0 David Paspa      27-Nov-2018            Reboot for S7-1500
// 0.1 Gerald Kontriner 14-Sep-2009            SFC structural design
HMI_FORMAT:- @@STEP_NUM_INT@@,@@STEP_TITLE@@

--------------------------------------------------
PARAMETER::1
--------------------------------------------------
Name:- log_real_pressure_mx
Type:- BOOL
Description:- UO_MX_SETUP Log vessel pressure during hold test
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::2
--------------------------------------------------
Name:- real_pressure_mx
Type:- REAL
Description:- UO_MX_SETUP Vessel pressure during hold test
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::3
--------------------------------------------------
Name:- log_real_pressure_vacuum_end
Type:- BOOL
Description:- UO_MX_SETUP Vessel pressure at vacuum hold test end
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::4
--------------------------------------------------
Name:- real_pressure_vacuum_end
Type:- REAL
Description:- UO_MX_SETUP Vessel pressure at vacuum hold test end
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::5
--------------------------------------------------
Name:- log_msg_vacuum_hold_end
Type:- BOOL
Description:- UO_MX_SETUP Vacuum hold end time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::6
--------------------------------------------------
Name:- emc_gas_setpoint
Type:- REAL
Description:- Pressure control setpoint
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::7
--------------------------------------------------
Name:- r_pres_gas_empty
Type:- REAL
Description:- Air pressure to empty vessel
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::8
--------------------------------------------------
Name:- prompt_vessel_empty_confirm_yes
Type:- BOOL
Description:- UO_MX_SETUP Operator confirm vessel drained confirmed yes
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::9
--------------------------------------------------
Name:- prompt_vessel_empty
Type:- BOOL
Description:- UO_MX_SETUP Operator to confirm vessel and lines fully drained
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::10
--------------------------------------------------
Name:- emm_vessel_mi_vessel_pv
Type:- REAL
Description:- Vessel measured mass
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::11
--------------------------------------------------
Name:- emx_drain_state
Type:- INT
Description:- State for MX drain valves
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::12
--------------------------------------------------
Name:- emx_drain_subs
Type:- INT
Description:- Substate for MX drain valves
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::13
--------------------------------------------------
Name:- emx_drain_cmd
Type:- INT
Description:- Command for MX drain valves
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::14
--------------------------------------------------
Name:- emv_inlet_subs
Type:- INT
Description:- Sprayball inlet substate
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::15
--------------------------------------------------
Name:- emv_inlet_state
Type:- INT
Description:- Sprayball inlet state
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::16
--------------------------------------------------
Name:- emv_inlet_cmd
Type:- INT
Description:- Sprayball inlet command
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::17
--------------------------------------------------
Name:- r_time_hex_drain
Type:- TIME
Description:- MX SETUP Heat exchanger drain time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::18
--------------------------------------------------
Name:- emt_hex_cmd
Type:- INT
Description:- Heat exchanger temperature control command
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::19
--------------------------------------------------
Name:- emt_hex_subs
Type:- INT
Description:- Heat exchanger temperature control substate
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::20
--------------------------------------------------
Name:- emt_hex_drain_time
Type:- TIME
Description:- Heat exchanger drain time
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::21
--------------------------------------------------
Name:- emt_hex_state
Type:- INT
Description:- Heat exchanger temperature control state
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::22
--------------------------------------------------
Name:- real_not_held
Type:- REAL
Description:- UO_MX_SETUP Vacuum pressure hold test failed
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::23
--------------------------------------------------
Name:- real_vacuum_fail
Type:- REAL
Description:- UO_MX_SETUP Vacuum failed pressure after vacuum timer expired
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::24
--------------------------------------------------
Name:- vessel_mx
Type:- INT
Description:- Manufacturing vessel selection M1 or M2
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::25
--------------------------------------------------
Name:- log_real_pressure_vacuum_begin
Type:- BOOL
Description:- UO_MX_SETUP Vessel pressure at vacuum hold test begin
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::26
--------------------------------------------------
Name:- real_pressure_vacuum_begin
Type:- REAL
Description:- UO_MX_SETUP Vessel pressure at vacuum hold test begin
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::27
--------------------------------------------------
Name:- emc_gas_pi_vessel_pv
Type:- REAL
Description:- Vessel pressure
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::28
--------------------------------------------------
Name:- log_real_not_held
Type:- BOOL
Description:- UO_MX_SETUP Vacuum pressure hold test failed
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::29
--------------------------------------------------
Name:- prompt_not_held
Type:- BOOL
Description:- UO_MX_SETUP Operator to confirm to retry as vacuum pressure not held
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::30
--------------------------------------------------
Name:- prompt_not_held_confirm_yes
Type:- BOOL
Description:- UO_MX_SETUP Operator to confirm to retry vacuum pressure not held confirmed yes
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::31
--------------------------------------------------
Name:- prompt_not_held_confirm_no
Type:- BOOL
Description:- UO_MX_SETUP Operator to confirm to retry vacuum pressure not held confirmed no
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::32
--------------------------------------------------
Name:- log_msg_not_held_repeat
Type:- BOOL
Description:- UO_MX_SETUP Operator confirmed to retry when vacuum pressure not held
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::33
--------------------------------------------------
Name:- log_msg_not_held_abort
Type:- BOOL
Description:- UO_MX_SETUP Operator confirmed to abort when vacuum pressure not held
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::34
--------------------------------------------------
Name:- prompt_not_reach
Type:- BOOL
Description:- UO_MX_SETUP Operator to confirm retry when vacuum pressure not reached setpoint
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::35
--------------------------------------------------
Name:- prompt_not_reach_confirm_yes
Type:- BOOL
Description:- UO_MX_SETUP Operator confirmed retry when vacuum pressure not reached setpoint
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::36
--------------------------------------------------
Name:- prompt_not_reach_confirm_no
Type:- BOOL
Description:- UO_MX_SETUP Operator confirmed abort when vacuum pressure not reached setpoint
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::37
--------------------------------------------------
Name:- log_msg_not_reach_repeat
Type:- BOOL
Description:- UO_MX_SETUP Operator confirmed retry when vacuum pressure not reached setpoint
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::38
--------------------------------------------------
Name:- log_msg_not_reach_abort
Type:- BOOL
Description:- UO_MX_SETUP Operator confirmed abort when vacuum pressure not reached setpoint
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::39
--------------------------------------------------
Name:- log_real_vacuum_fail
Type:- BOOL
Description:- UO_MX_SETUP Vacuum failed after vacuum timer expired
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::40
--------------------------------------------------
Name:- log_msg_vacuum_hold_begin
Type:- BOOL
Description:- UO_MX_SETUP Vacuum hold begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::41
--------------------------------------------------
Name:- log_msg_setup_end
Type:- BOOL
Description:- UO_MX_SETUP end time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::42
--------------------------------------------------
Name:- log_msg_setup_begin
Type:- BOOL
Description:- UO_MX_SETUP begin time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::43
--------------------------------------------------
Name:- r_pres_vac_fail
Type:- REAL
Description:- MX SETUP Vacuum hold test fail pressure
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::44
--------------------------------------------------
Name:- r_pres_vac
Type:- REAL
Description:- MX SETUP Vacuum setpoint
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::45
--------------------------------------------------
Name:- r_time_vac_hold
Type:- TIME
Description:- MX SETUP Time for vacuum hold test
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::46
--------------------------------------------------
Name:- r_time_eject
Type:- TIME
Description:- MX SETUP Time to run vacuum system before timeout
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::47
--------------------------------------------------
Name:- emc_gas_medium_gas
Type:- INT
Description:- Medium selection for emc_gas
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::48
--------------------------------------------------
Name:- vacuum_hold_test
Type:- BOOL
Description:- Vacuum hold test enquiry
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::49
--------------------------------------------------
Name:- emm_vessel_cmd
Type:- INT
Description:- Command to emm_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::50
--------------------------------------------------
Name:- emm_vessel_subs
Type:- INT
Description:- Substate selection to emm_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::51
--------------------------------------------------
Name:- emm_vessel_state
Type:- INT
Description:- Device State of emm_vessel
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::52
--------------------------------------------------
Name:- emc_water_cmd
Type:- INT
Description:- Command to emc_water
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::53
--------------------------------------------------
Name:- emc_water_subs
Type:- INT
Description:- Substate selection to emc_water
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::54
--------------------------------------------------
Name:- emc_water_state
Type:- INT
Description:- Device State of emc_water
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::55
--------------------------------------------------
Name:- prompt_connect_ok_confirm_yes
Type:- BOOL
Description:- UO_MX_SETUP Operator confirm vessel connections made confirmed yes
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::56
--------------------------------------------------
Name:- prompt_connect_ok
Type:- BOOL
Description:- UO_MX_SETUP Operator to confirm all vessel connections are properly made
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::57
--------------------------------------------------
Name:- emc_water_medium_liquid
Type:- INT
Description:- Medium selection for emc_water
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::58
--------------------------------------------------
Name:- emx_mmfl_cmd
Type:- INT
Description:- Command to emx_mmfl
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::59
--------------------------------------------------
Name:- emx_mmfl_state
Type:- INT
Description:- Device State of emx_mmfl
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::60
--------------------------------------------------
Name:- emv_vessel_subs
Type:- INT
Description:- Substate selection to emv_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::61
--------------------------------------------------
Name:- emv_vessel_state
Type:- INT
Description:- Device State of EVxy04
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::62
--------------------------------------------------
Name:- emx_mmfl_subs
Type:- INT
Description:- Substate selection to emx_mmfl
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::63
--------------------------------------------------
Name:- emv_vessel_cmd
Type:- INT
Description:- Command to emv_vessel
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::64
--------------------------------------------------
Name:- emg_filter_state
Type:- INT
Description:- Device State of emg_filter
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::65
--------------------------------------------------
Name:- emx_transfer_cmd
Type:- INT
Description:- Command to emx_transfer
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::66
--------------------------------------------------
Name:- emg_filter_cmd
Type:- INT
Description:- Command to emg_filter
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::67
--------------------------------------------------
Name:- emx_transfer_subs
Type:- INT
Description:- Substate selection to EXxy07
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::68
--------------------------------------------------
Name:- emx_transfer_state
Type:- INT
Description:- Device State of emx_transfer
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::69
--------------------------------------------------
Name:- emg_filter_subs
Type:- INT
Description:- Substate selection to emg_filter
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::70
--------------------------------------------------
Name:- emc_gas_state
Type:- INT
Description:- Device State of emc_gas
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::71
--------------------------------------------------
Name:- emc_gas_cmd
Type:- INT
Description:- Command to emc_gas
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::72
--------------------------------------------------
Name:- emc_gas_subs
Type:- INT
Description:- Substate selection to emc_gas
ParameterInOut:- OUT


--------------------------------------------------
STEP::01
--------------------------------------------------
StepNo:- 01
Title:- UO_MX_SETUP : Setup Unit Operation Commenced
Description:- Log Mx SETUP operation begin time.
Prompt operator to confirm that all vessel connections, including the permanent flexible connections are properly made.

Start EMX1_SETUP_CIPSIP to connect MMFLx to Drain.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Reset the MMFL transfer line EM
Action:- L "dbCONST".BLK.CMD.STOP;
T #_emx_mmfl_cmd;
Verification:- A(;
L   #_emx_mmfl_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Log Mx SETUP operation begin time.
Prompt operator to confirm correct vessel connections.
Start EMX1_SETUP_CIPSIP
Action:- //Log CIPSIP operation begin
SET;
S #_log_msg_setup_begin;

SET;
S #_prompt_connect_ok;

//Start EMX1_CIPSIP_SETUP.
L "dbCONST".BLK.EMX1.SUBS.SETUP_CIPSIP;
T #_emx_mmfl_subs;
L "dbCONST".BLK.CMD.START;
T #_emx_mmfl_cmd;
Verification:- A(;
L #_emx_mmfl_subs;
L "dbCONST".BLK.EMX1.SUBS.SETUP_CIPSIP;
==I;
);


--------------------------------------------------
TRANSITION::01
--------------------------------------------------
TRNNo:- 01
Title:- Confirmation received.
EmptyTransition:- False
Description:- Confirmation from operator received and CIPSIP_SETUP finished.
Condition:- A #_prompt_connect_ok_confirm_yes;
A(;
L #_emx_mmfl_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);


--------------------------------------------------
STEP::02
--------------------------------------------------
StepNo:- 02
Title:- UO_MX_SETUP : Setup for PW and drain heat exchanger
Description:- Set emc_water to substate SETUP with MEDIUM PW.

Drain the heat exchanger.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Action Description
Action:- L "dbCONST".BLK.CMD.STOP;
T    #_emc_water_cmd;
T    #_emt_hex_cmd;
Verification:- A(;
L   #_emc_water_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);
A(;
L   #_emt_hex_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Set emc_water to substate SETUP (Medium PW).

Action:- //Clear used flag
SET;
R #_prompt_connect_ok_confirm_yes;

//Set to Medium PW and start EMC2_SETUP.
L    "dbCONST".SEL.LIQUID.PW;
T    #_emc_water_medium_liquid;
L    "dbCONST".BLK.EMC2.SUBS.SETUP;
T    #_emc_water_subs;
L    "dbCONST".BLK.CMD.START;
T    #_emc_water_cmd;
Verification:- //Verify if current substate changed to SETUP.
A(;
L #_emc_water_subs;
L    "dbCONST".BLK.EMC2.SUBS.SETUP;
==I;
);

--------------------------------------------------
ACTION::03
--------------------------------------------------
Description:- Drain the heat exchanger of process cooling water
Action:- //Set to Medium PW and start EMC2_SETUP.
L    #_r_time_hex_drain;
L 1000;
*I;
T    #_emt_hex_drain_time;
L    "dbCONST".BLK.EMT1.SUBS.DRAIN;
T    #_emt_hex_subs;
L    "dbCONST".BLK.CMD.START;
T    #_emt_hex_cmd;
Verification:- //Verify if hex substate changed to DRAIN
A(;
L #_emt_hex_subs;
L    "dbCONST".BLK.EMT1.SUBS.DRAIN;
==I;
);


--------------------------------------------------
TRANSITION::02
--------------------------------------------------
TRNNo:- 02
Title:- emc_water substate SETUP complete.
EmptyTransition:- False
Description:- emc_water substate SETUP is complete and hex draining complete.
Condition:- A(;
L   #_emc_water_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);
A(;
L   #_emt_hex_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);


--------------------------------------------------
STEP::03
--------------------------------------------------
StepNo:- 03
Title:- UO_MX_SETUP : Open valves on Mx to drain flow path.
Description:- Open Mx outlet and MMFL transfer line valves.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Reset EMs
Action:- L "dbCONST".BLK.CMD.STOP;
T #_emc_gas_cmd;
T #_emv_inlet_cmd;
T #_emv_vessel_cmd;
T #_emx_mmfl_cmd;
T #_emx_drain_cmd;
Verification:- A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);
A(;
L   #_emv_inlet_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);
A(;
L   #_emv_vessel_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);
A(;
L   #_emx_mmfl_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);
A(;
L   #_emx_drain_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Open valves on Mx to drain flow path to drain the vesse with HPCA air pressurel.
Clear used flags.
Action:- //Open Mx inlet valve.
L "dbCONST".BLK.EMV2.SUBS.CHARGE;
T #_emv_inlet_subs;
L "dbCONST".BLK.CMD.START;
T #_emv_inlet_cmd;

//Open Mx outlet valve.
L "dbCONST".BLK.EMV1.SUBS.DISCHARGE;
T #_emv_vessel_subs;
L "dbCONST".BLK.CMD.START;
T #_emv_vessel_cmd;

//Open MMFL valves.
L "dbCONST".BLK.EMX1.SUBS.SIP;
T #_emx_mmfl_subs;
L "dbCONST".BLK.CMD.START;
T #_emx_mmfl_cmd;

//Open CIP drain valve.
L "dbCONST".BLK.EMX4.SUBS.CIP;
T #_emx_drain_subs;
L "dbCONST".BLK.CMD.START;
T #_emx_drain_cmd;

//Enable HPCA.
L "dbCONST".SEL.GAS.HPCA;
T #_emc_gas_medium_gas;
L #_r_pres_gas_empty;
T #_emc_gas_setpoint;
L "dbCONST".BLK.EMC1.SUBS.PRESSURE;
T #_emc_gas_subs;
L "dbCONST".BLK.CMD.START;
T #_emc_gas_cmd;
Verification:- A(;
L #_emv_inlet_subs;
L "dbCONST".BLK.EMV2.SUBS.CHARGE;
==I;
);
A(;
L #_emv_vessel_subs;
L "dbCONST".BLK.EMV1.SUBS.DISCHARGE;
==I;
);
A(;
L #_emx_mmfl_subs;
L "dbCONST".BLK.EMX1.SUBS.SIP;
==I;
);
A(;
L #_emx_drain_subs;
L "dbCONST".BLK.EMX4.SUBS.CIP;
==I;
);
A(;
L #_emc_gas_subs;
L "dbCONST".BLK.EMC1.SUBS.PRESSURE;
==I;
);


--------------------------------------------------
TRANSITION::03
--------------------------------------------------
TRNNo:- 03
Title:- Drain valves opened
EmptyTransition:- False
Description:- Drain path valves are opened.
Condition:- A(;
L   #_emv_inlet_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);
A(;
L   #_emv_vessel_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);
A(;
L   #_emx_mmfl_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);
A(;
L   #_emx_drain_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);
A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);


--------------------------------------------------
STEP::04
--------------------------------------------------
StepNo:- 04
Title:- UO_MX_SETUP : Wait for operator to confirm vessel empty
Description:- Prompt operator to confirm vessel empty

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Prompt operator to confirm vessel empty
Action:- SET;
S #_prompt_vessel_empty;


--------------------------------------------------
TRANSITION::04
--------------------------------------------------
TRNNo:- 04
Title:- Wait for vessel confirmed empty
EmptyTransition:- False
Description:- Jump when operator confirms vessel and lines fully drained
Condition:- A #_prompt_vessel_empty_confirm_yes;


--------------------------------------------------
STEP::05
--------------------------------------------------
StepNo:- 05
Title:- UO_MX_SETUP : Close drain valve
Description:- Close outlet line drain valve.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Reset EMs
Action:- L "dbCONST".BLK.CMD.STOP;
T #_emc_gas_cmd;
T #_emx_drain_cmd;
Verification:- A(;
L   #_emx_drain_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);
A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);


--------------------------------------------------
TRANSITION::05
--------------------------------------------------
TRNNo:- 5.0000
Title:- Empty transition
EmptyTransition:- False
Description:- Unconditional jump
Condition:- A "uncondJump";


--------------------------------------------------
STEP::06
--------------------------------------------------
StepNo:- 06
Title:- UO_MX_SETUP : Start Vacuum
Description:- Enable vacuum. 
Start vacuum timer(TIME_EJECT). 
Log Vacuum begin time

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Reset gas EM
Action:- L "dbCONST".BLK.CMD.STOP;
T #_emc_gas_cmd;
Verification:- A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.STOPPED;
==I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Enable vacuum.
Reset timer.
Action:- //Enable vacuum.
L "dbCONST".SEL.GAS.VACUUM;
T #_emc_gas_medium_gas;
L "dbCONST".BLK.EMC1.SUBS.VALVE;
T #_emc_gas_subs;
L "dbCONST".BLK.CMD.START;
T #_emc_gas_cmd;

//Start Timer for vacuum timeout
A #SQ_TIMER.Q;
R #sqSeqTimerStart;

AN #SQ_TIMER.Q;
S #sqSeqTimerStart;
L #_r_time_eject;
L 1000;
*I;
T #SQ_TIMER.PT;


Verification:- A #sqSeqTimerStart;


--------------------------------------------------
TRANSITION::06
--------------------------------------------------
TRNNo:- 6.0000
Title:- Timer expired?
EmptyTransition:- False
Description:- Vacuum timer expired.
Condition:- A #SQ_TIMER.Q;


--------------------------------------------------
TRANSITION::07
--------------------------------------------------
TRNNo:- 7.0000
Title:- Pressure below setpoint?
EmptyTransition:- False
Description:- Pressure reduced below PRES_VAC.
Condition:- A(;
L #_emc_gas_pi_vessel_pv;
L #_r_pres_vac;
<R;
);


--------------------------------------------------
STEP::07
--------------------------------------------------
StepNo:- 7.0000
Title:- UO_MX_SETUP : Vacuum hold evacuation failed 
Description:- Raise vacuum failed message.
Log vacuum ejector time failed.
Prompt operator to confirm to try again.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Raise vacuum failed message.
Log vacuum time failed.
Prompt operator to confirm to try again.
Action:- //Set flag to raise vacuum failed message
SET;
S #_log_real_vacuum_fail;
S #_prompt_not_reach;

//Log pressure after vacuum timer expired(TIME_EJECT failed).
L #_emc_gas_pi_vessel_pv;
T #_real_vacuum_fail;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::08
--------------------------------------------------
TRNNo:- 8.0000
Title:- Try again?
EmptyTransition:- False
Description:- Operator want to try again.
Condition:- A #_prompt_not_reach_confirm_yes;


--------------------------------------------------
TRANSITION::09
--------------------------------------------------
TRNNo:- 9.0000
Title:- No try?
EmptyTransition:- False
Description:- Operator don't want to try again.
Condition:- A #_prompt_not_reach_confirm_no;


--------------------------------------------------
STEP::08
--------------------------------------------------
StepNo:- 08
Title:- UO_MX_SETUP : Start Vacuum Hold Timer
Description:- Close Mx vent line vacuum valve.
Start Vacuum  Hold Timer.
Store Vacuum Hold test begin time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Close Mx vacuum valves.
Action:- //Close Mx vacuum valve.
L "dbCONST".SEL.GAS.NONE;
T #_emc_gas_medium_gas;
L "dbCONST".BLK.CMD.RESTART;
T #_emc_gas_cmd;

//Start Timer for vacuum hold
A #SQ_TIMER.Q;
R #sqSeqTimerStart;

AN #SQ_TIMER.Q;
S #sqSeqTimerStart;
L #_r_time_vac_hold;
L 1000;
*I;
T #SQ_TIMER.PT;

//Store Vacuum Hold test begin time.
SET;
S _log_msg_vacuum_hold_begin;

//Log Mx vessel pressure.
L #_emc_gas_pi_vessel_pv;
T #_real_pressure_vacuum_begin;

SET;
S #_log_real_pressure_vacuum_begin;
Verification:- A #sqSeqTimerStart;
A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.STOPPED;
>I;
);
A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.INTERLOCKED;
<I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Start Vacuum Hold Timer.
Store Vacuum Hold test begin time.
Action:- L "dbCONST".BLK.CMD.START;
T #_emc_gas_cmd;



--------------------------------------------------
TRANSITION::10
--------------------------------------------------
TRNNo:- 10
Title:- Jump when gas command completed
EmptyTransition:- False
Condition:- A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.COMPLETED;
==I;
);


--------------------------------------------------
STEP::09
--------------------------------------------------
StepNo:- 9.0000
Title:- UO_MX_SETUP : Log operator repeat
Description:- Log operator repeat.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log operator repeat.
Action:- //Log operator repeat.
SET;
S #_log_msg_not_reach_repeat;
R #_prompt_not_reach_confirm_yes;
R #sqSeqTimerStart;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::11
--------------------------------------------------
TRNNo:- 11.0000
Title:- Empty Transition
EmptyTransition:- False
Description:- Empty Transition
Condition:- A "uncondJump";


--------------------------------------------------
STEP::10
--------------------------------------------------
StepNo:- 10.0000
Title:- UO_MX_SETUP : Log operator abort
Description:- Log operator abort.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log operator ABORT.
Action:- //Log operator abort.
SET;
S #_log_msg_not_reach_abort;
R #_prompt_not_reach_confirm_no;
R #sqSeqTimerStart;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::12
--------------------------------------------------
TRNNo:- 12.0000
Title:- Empty Transition
EmptyTransition:- False
Description:- Empty Transition
Condition:- A "uncondJump";


--------------------------------------------------
STEP::11
--------------------------------------------------
StepNo:- 11.0000
Title:- UO_MX_SETUP : Vacuum hold test
Description:- Step required for loop reentry

--------------------------------------------------
ACTION::01
--------------------------------------------------

--------------------------------------------------
TRANSITION::13
--------------------------------------------------
TRNNo:- 13.0000
Title:- Empty transition
EmptyTransition:- False
Condition:- A "uncondJump";


--------------------------------------------------
STEP::12
--------------------------------------------------
StepNo:- 12.0000
Title:- UO_MX_SETUP : Pressure logging
Description:- Log vessel pressure at 30 second intervals.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Set flags to log Sy vessel pressure.
Action:- // Clear gas EM restart command
L "dbCONST".BLK.CMD.START;
T #_emc_gas_cmd;

//Log Mx vessel pressure.
L #_emc_gas_pi_vessel_pv;
T #_real_pressure_mx;

A #SQ_TIMER2.Q;
R #sqSeqTimerStart2;
R #_log_real_pressure_mx;

AN #SQ_TIMER2.Q;
S #sqSeqTimerStart2;
S #_log_real_pressure_mx;
L T#30S;
T #SQ_TIMER2.PT;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::14
--------------------------------------------------
TRNNo:- 14.0000
Title:- Timer Expired
EmptyTransition:- False
Description:- TIME_VAC_HOLD expired
Condition:- A #SQ_TIMER.Q;


--------------------------------------------------
TRANSITION::15
--------------------------------------------------
TRNNo:- 15.0000
Title:- Pressure above setpoint
EmptyTransition:- False
Description:- Pressure increased above PRES_VAC_FAIL
Condition:- O(;
L #_emc_gas_pi_vessel_pv;
L #_r_pres_vac_fail;
>R;
);


--------------------------------------------------
TRANSITION::16
--------------------------------------------------
TRNNo:- 16.0000
Title:- Pressure logging timer expired
EmptyTransition:- False
Description:- 30 seconds expired
Condition:-  A #SQ_TIMER2.Q;


--------------------------------------------------
STEP::13
--------------------------------------------------
StepNo:- 13.0000
Title:- UO_MX_SETUP : Vacuum Hold failed
Description:- Set flag to raise vacuum failed message and prompt operator.
Log Mx vessel pressure.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Set flag to raise vacuum failed message and prompt operator.
Log Mx vessel pressure.
Action:- //Set flag to raise vacuum failed message and prompt operator.
SET;
S #_log_real_not_held;
S #_prompt_not_held;


// Stop timer
SET;
R #sqSeqTimerStart;
R #sqSeqTimerStart2;

//Log Mx vessel pressure.
L #_emc_gas_pi_vessel_pv;
T #_real_not_held;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::17
--------------------------------------------------
TRNNo:- 17.0000
Title:- No try?
EmptyTransition:- False
Description:- Operator don't want to try again.
Condition:- A #_prompt_not_held_confirm_no;


--------------------------------------------------
TRANSITION::18
--------------------------------------------------
TRNNo:- 18.0000
Title:- Try again?
EmptyTransition:- False
Description:- Operator want to try again.
Condition:- A #_prompt_not_held_confirm_yes;


--------------------------------------------------
STEP::14
--------------------------------------------------
StepNo:- 14
Title:- UO_MX_SETUP : Log operator abort
Description:- Log operator abort.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log operator abort.
Action:- //Log operator abort.
SET;
S #_log_msg_not_held_abort;
R #_prompt_not_held_confirm_no;
S #smc.ABORTED;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::19
--------------------------------------------------
TRNNo:- 19.0000
Title:- Empty Transition
EmptyTransition:- False
Description:- Empty Transition
Condition:- A "uncondJump";


--------------------------------------------------
STEP::15
--------------------------------------------------
StepNo:- 15.0000
Title:- UO_MX_SETUP : Log operator repeat
Description:- Log operator repeat

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log operator repeat
Action:- //Log operator repeat.
SET;
S #_log_msg_not_held_repeat;
R #_prompt_not_held_confirm_yes;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::20
--------------------------------------------------
TRNNo:- 20.0000
Title:- Empty Transition
EmptyTransition:- False
Description:- Empty Transition
Condition:- A "uncondJump";


--------------------------------------------------
STEP::16
--------------------------------------------------
StepNo:- 16
Title:- UO_MX_SETUP : Log actual time vacuum held.
Description:- Log actual time vacuum held.
Log Mx vessel pressure.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log actual time vacuum held.
Log Mx vessel pressure.
Action:- //Store Vacuum Hold test end time.
SET;
S _log_msg_vacuum_hold_end;

R #sqSeqTimerStart2;

//Log Mx vessel pressure.
L #_emc_gas_pi_vessel_pv;
T #_real_pressure_vacuum_end;

SET;
S #_log_real_pressure_vacuum_end;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::21
--------------------------------------------------
TRNNo:- 21.0000
Title:- Empty Transition
EmptyTransition:- False
Description:- Empty Transition
Condition:- A "uncondJump";


--------------------------------------------------
STEP::17
--------------------------------------------------
StepNo:- 17.0000
Title:- UO_MX_SETUP : Break vacuum
Description:- Open HPCA supply valve to break the vacuum.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Open HPCA valve to break the vacuum
Action:- L "dbCONST".SEL.GAS.HPCA;
T #_emc_gas_medium_gas;
L "dbCONST".BLK.CMD.RESTART;
T #_emc_gas_cmd;
Verification:- A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.STOPPED;
>I;
);
A(;
L   #_emc_gas_state;
L   "dbCONST".BLK.STATE.INTERLOCKED;
<I;
);

--------------------------------------------------
ACTION::02
--------------------------------------------------
Description:- Clear gas EM restart command
Action:- L "dbCONST".BLK.CMD.START;
T #_emc_gas_cmd;


--------------------------------------------------
TRANSITION::22
--------------------------------------------------
TRNNo:- 22.0000
Title:- Pressure at zero
EmptyTransition:- False
Description:- Pressure increased to 0
Condition:- O(;
L #_emc_gas_pi_vessel_pv;
L 0.0;
>R;
);


--------------------------------------------------
STEP::18
--------------------------------------------------
StepNo:- 18.0000
Title:- UO_MX_SETUP : Setup Unit Operation Completed
Description:- Clear used flags.
Log Mx SETUP operation end time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Clear used flags.
Log Mx SETUP operation end time.
Action:- // Stop gas
L "dbCONST".BLK.CMD.STOP;
T #_emc_gas_cmd; 

//Clear used flags
SET;
R #_prompt_connect_ok;
R #_prompt_connect_ok_confirm_yes;

//Log SETUP operation end time.
SET;
S #_log_msg_setup_end;
Verification:- A "uncondJump";

****************************************************************************************************
END SSS REPORT
****************************************************************************************************
