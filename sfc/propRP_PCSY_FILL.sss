****************************************************************************************************
SEQUENCE STEP SCHEDULE
generated on 29/06/2018 2:54:19 PM by David Paspa
****************************************************************************************************





--------------------------------------------------
SEQUENCE
--------------------------------------------------

SFCNo:- 3
Title:- RP_PCSY_FILL
Description:- Recipe Procedure for Transfer from Storage Vessel Sy to Filling (Vial or Ampoule)
Name:- FILL
Class:- PCSY
Level:- RP
STEP_LIST_FORMAT:- JU    S0@@STEP_NUM@@; // STEP-0@@STEP_NUM@@:
ACT_LIST_FORMAT:- JU    @@ACT_CODE@@@@STEP_NUM@@; //ACTION-@@ACT_NUM@@
HeaderName:- PCSFIL
Version:- 0.2
RevisionHistory:- // SFC Revision History:
// Rev By               Date        CC         Note
// 0.2 Khairul Bhasar   02-Nov-2009 09/058     Added Ampoule and Vial Filling switches
// 0.1 Gerald Kontriner 18-Sep-2009            SFC structural design
HMI_FORMAT:- @@STEP_NUM_INT@@,@@STEP_TITLE@@

--------------------------------------------------
PARAMETER::1
--------------------------------------------------
Name:- vessel_sy
Type:- INT
Description:- Storage vessel selection S1 or S2
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::2
--------------------------------------------------
Name:- fill_flz
Type:- INT
Description:- Filling line selection FL1 or FL2
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::3
--------------------------------------------------
Name:- log_time_fill_end
Type:- BOOL
Description:- Flags the HMI that FILL operation ended

ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::4
--------------------------------------------------
Name:- log_time_fill_begin
Type:- BOOL
Description:- Flags the HMI that FILL operation started
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::5
--------------------------------------------------
Name:- log_time_wrong_hygiene
Type:- BOOL
Description:- Flags the HMI that wrong hygiene status detected
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::6
--------------------------------------------------
Name:- release_flz
Type:- BOOL
Description:- Description
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::7
--------------------------------------------------
Name:- prompt_abort_confirm_yes
Type:- BOOL
Description:- Operator Acknowledge Abort Due to Invalid Hygiene Status
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::8
--------------------------------------------------
Name:- prompt_abort
Type:- BOOL
Description:- Prompt operator abort due to Invalid Hygiene Status
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::9
--------------------------------------------------
Name:- log_msg_wrong_hygiene
Type:- BOOL
Description:- HMI message: Sy has incorrect Hygiene Status
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::10
--------------------------------------------------
Name:- sy_vessel_hygiene
Type:- INT
Description:- Hygiene Status of unit Sy
ParameterInOut:- IN_OUT

--------------------------------------------------
PARAMETER::11
--------------------------------------------------
Name:- toggle_mode
Type:- BOOL
Description:- Toggle mode of all used units
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::12
--------------------------------------------------
Name:- time_wrong_hygiene
Type:- TOD
Description:- Logging that Sy has incorrect Hygiene Status
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::13
--------------------------------------------------
Name:- time_fill_end
Type:- TOD
Description:- Logging FILL operation end time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::14
--------------------------------------------------
Name:- time_fill_begin
Type:- TOD
Description:- Logging FILL operation start time
ParameterInOut:- VAR

--------------------------------------------------
PARAMETER::15
--------------------------------------------------
Name:- sy_vessel_state
Type:- INT
Description:- Device State of unit Sy
ParameterInOut:- IN

--------------------------------------------------
PARAMETER::16
--------------------------------------------------
Name:- sy_vessel_subs
Type:- INT
Description:- Substate selection to unit Sy
ParameterInOut:- OUT

--------------------------------------------------
PARAMETER::17
--------------------------------------------------
Name:- sy_vessel_cmd
Type:- INT
Description:- Command to unit Sy
ParameterInOut:- OUT


--------------------------------------------------
STEP::01
--------------------------------------------------
StepNo:- 01
Title:- RP_PCSY_FILL: Recipe Procedure Commenced
Description:- Log transfer from storage to filling operation begin time.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log transfer from storage to filling operation begin time.
Action:- //Log Sy FILL operation begin
L "dbCONST".CHRONO.CPU_TIME;
T #_time_fill_begin;

SET;
S #_log_time_fill_begin;
R #_toggle_mode;
R #_prompt_abort;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::01
--------------------------------------------------
TRNNo:- 01
Title:- Check Hygiene Status
EmptyTransition:- False
Description:- Selected Sy is in Hygiene status BATCH?
Condition:- A(;
L "dbCONST".BLK.HYGIENE.BATCH;
L #_sy_vessel_hygiene;
==I;
);


--------------------------------------------------
TRANSITION::02
--------------------------------------------------
TRNNo:- 02
Title:- Incorrect Hygiene Status
EmptyTransition:- False
Description:- Empty Transition
Condition:- A "uncondJump";


--------------------------------------------------
STEP::02
--------------------------------------------------
StepNo:- 02
Title:- RP_PCSY_FILL : Incorrect Hygiene Status
Description:- Log that Sy is not in Hygiene status BATCH.
Prompt operator to confirm abort.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Log that Sy is not in Hygiene status BATCH.
Action:- //Log time if Sy not in correct Hygiene status BATCH
L "dbCONST".CHRONO.CPU_TIME;
T #_time_wrong_hygiene;

SET;
S #_log_time_wrong_hygiene;
S #_log_msg_wrong_hygiene;
S #_prompt_abort;
Verification:- A "uncondJump";


--------------------------------------------------
TRANSITION::03
--------------------------------------------------
TRNNo:- 03
Title:- Confirm Abort (Incorrect Hygiene Status)
EmptyTransition:- False
Description:- Confirm Abort (Incorrect Hygiene Status)
Condition:- A #_prompt_abort_confirm_yes;


--------------------------------------------------
STEP::03
--------------------------------------------------
StepNo:- 03
Title:- RP_PCSY_FILL : Start Sy FILL Unit Operations
Description:- Toggle all Units From Manual to Auto. This will cascade down to make sure all equipment is in Auto.

Initiate Unit Operations
SY STATE=FILL

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Toggle all Units From Manual to Auto. This will cascade down to make sure all equipment is in Auto.

Initiate SY STATE=FILL Unit Operation
Action:- //Toggle all Units From Manual to Auto. This will cascade down to make sure all equipment is in Auto.
SET;
S #_toggle_mode;

//Initiate SY STATE=FILL Unit Operation
L "dbCONST".BLK.SY.SUBS.FILL;
T #_sy_vessel_subs;
L "dbCONST".BLK.CMD.START;
T #_sy_vessel_cmd;
Verification:- A(;
L #_sy_vessel_state;
L "dbCONST".BLK.SY.SUBS.FILL;
==I;
);


--------------------------------------------------
TRANSITION::04
--------------------------------------------------
TRNNo:- 04
Title:- FILL operations complete?
EmptyTransition:- False
Description:- SY FILL operation completed
Condition:- A(;
L #_sy_vessel_state;
L "dbCONST".BLK.STATE.COMPLETED;
==I;
);


--------------------------------------------------
STEP::04
--------------------------------------------------
StepNo:- 04
Title:- RP_PCSY_FILL : Sy Filling Unit Operation Finished
Description:- Now finished with Sy. 
Set Sy Hygiene Status to USED.

Release FLZ unit from the CRP

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Set Sy Hygiene Status to USED.
Action:- //Set Sy Hygiene Status to USED.
L "dbCONST".BLK.HYGIENE.USED;
T #_sy_vessel_hygiene;

//Release FLZ
SET;
S #_release_flz;
Verification:- A "uncondJump";


--------------------------------------------------
STEP::05
--------------------------------------------------
StepNo:- 05
Title:- RP_PCSY_FILL : Recipe Procedure Completed
Description:- Set equipment to SAFE state.
Log filling operation complete.

--------------------------------------------------
ACTION::01
--------------------------------------------------
Description:- Set equipment to SAFE state.
Action:- A(;
L "dbCONST".BLK.HYGIENE.USED;
L #_sy_vessel_hygiene;
==I;
);

//put substate to none of sy
L "dbCONST".BLK.SAFE.CMD;
T #_sy_vessel_subs;

//Log product manufacture operation end
L "dbCONST".CHRONO.CPU_TIME;
T #_time_fill_end;

SET;
S #_log_time_fill_end;

//Clear used flags
R #_toggle_mode;
R #_prompt_abort_confirm_yes;
Verification:- A "uncondJump";

****************************************************************************************************
END SSS REPORT
****************************************************************************************************
