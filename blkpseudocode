Declare VAR_INPUT
Declare VAR_OUTPUT
Declare VAR_IN_OUT
Declare VAR
Declare VAR_TEMP

If any Calling Parameter invalid
	Set flagBadParameter

If any Child in MANUAL mode
	Set flagChildManual

If any Child in INTERLOCKED state
	Set flagChildInterlocked

If any Child not Owned or not Available
	Set flagChildUnavailable

If flagChildManual OR flagChildInterlocked OR flagChildUnavailable
	Set flagChildFailed 

Call Mode and Command Handling Block
	If no Owner 
		Set flagAvailable

	If any Interlock condition or flagBadParameter
		Set block INTERLOCK flag
		Set block state INTERLOCKED

	If flagChildFailed and block STATE is STOPPED
		Set block state INTERLOCKED

	If flagChildFailed and block STATE is RUNNING
		Set block state PAUSED

	Auto/Manual/OOS Mode Change
	Auto/Manual Command Change
	Substate Change

  	if new Substate
		Set flagNewSubstate

If flagNewSubstate and not flagChildFailed
	If child block Available
		Take Ownership and record for later Release

	Convert substates to flags
	Convert calling parameter selections to flags
	Store child device initial commands to current commands
	Store child device initial commands to previous commands
	Command child devices to current commands

	If flagSubstateHasSFC
		Write current child commands to SFC child commands
		Initiate SFC
		Set flagSFCRunning

	Clear flagNewSubstate

If any Child state does not match command
	Set flagChildMismatch
	Set block state INTERLOCKED

If flagSFCRunning
	Write SFC child commands to current commands
	Write current commands to child devices
	Write current commands to previous commands
		
	If SFC complete
		Clear flagSFCRunning
		Set flagSFCCompleted

If flagSFCCompleted
	Release any child devices taken Ownership
	Set block state COMPLETED
	Clear flagSFCCompleted
